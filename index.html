<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Future Finders Chama Group</title>
  <style>
   body { 
  font-family: Arial, sans-serif; 
  margin: 0; 
  padding: 0; 
  background: #f9f9f9; 
  padding-bottom: 60px; /* prevent overlap with footer */
}

header { 
  background: #00695c; 
  color: white; 
  padding: 1.5rem; 
  text-align: center; 
}

/* NAV BUTTONS */
#navButtons { 
  display: flex; 
  flex-wrap: wrap; 
  gap: 0.8rem; 
  justify-content: center; 
  margin: 1.5rem; 
}

.nav-btn {
  flex: 1 1 180px; 
  background-color: #00796b; 
  color: white;
  padding: 1rem; 
  text-align: center; 
  border-radius: 6px;
  text-decoration: none; 
  font-weight: bold; 
  position: relative;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2); 
  cursor: pointer;
}
.nav-btn:hover { background-color: #004d40; }

/* Spinner */
.spinner {
  display: none; 
  border: 3px solid #f3f3f3; 
  border-top: 3px solid white;
  border-radius: 50%; 
  width: 18px; 
  height: 18px; 
  animation: spin 1s linear infinite;
  position: absolute; 
  right: 12px; 
  top: 50%; 
  transform: translateY(-50%);
}
@keyframes spin { 
  0% { transform: translateY(-50%) rotate(0deg);} 
  100% { transform: translateY(-50%) rotate(360deg);} 
}

/* Sections */
section {
  padding: 2rem; 
  background: white; 
  margin: 1rem auto; 
  border-radius: 8px;
  max-width: 900px; 
  box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
  display: none;
}
section.active { display: block; }

input, select {
  padding: 10px; 
  margin: 10px auto; 
  width: 80%; 
  display: block;
  border: 1px solid #ccc; 
  border-radius: 5px;
}

.action-btn {
  display: block; 
  background-color: #388e3c; 
  color: white;
  padding: 0.9rem; 
  margin: 0.5rem auto; 
  text-align: center;
  border-radius: 6px; 
  text-decoration: none; 
  font-weight: bold;
  position: relative; 
  max-width: 250px; 
  cursor: pointer;
}
.action-btn:hover { background-color: #1b5e20; }

#dashboard, #admin { 
  display: none; 
  padding: 1rem; 
  border-radius: 6px; 
  margin-top: 20px; 
  background: #f1f8e9; 
}

/* Popup Overlay */
.popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

/* Popup Box */
.popup-box {
  background: white;
  padding: 20px 30px;
  border-radius: 10px;
  text-align: center;
  max-width: 350px;
  box-shadow: 0px 5px 15px rgba(0,0,0,0.3);
  animation: popupFade 0.3s ease;
}

.popup-box h3 {
  margin-bottom: 10px;
}

.popup-success {
  border-top: 6px solid #4caf50;
}
.popup-error {
  border-top: 6px solid #f44336;
}

.popup-btn {
  margin-top: 15px;
  padding: 8px 16px;
  background: #1976d2;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

@keyframes popupFade {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

/* Glow effect */
.glow {
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 5px #ff0, 0 0 10px #ff0, 0 0 20px #ffa500;
  font-size: 18px;
}

/* Footer */
footer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #111;
  color: white;
  text-align: center;
  padding: 12px 0;
  z-index: 1000;
  overflow: hidden;
}

/* Modern marquee effect */
.footer-marquee {
  display: inline-block;
  white-space: nowrap;
  animation: marquee 12s linear infinite;
}

@keyframes marquee {
  from { transform: translateX(100%); }
  to   { transform: translateX(-100%); }
}
/* Check Loan Eligibility Button */
.check-loan-btn {
  background: linear-gradient(135deg, #1976d2, #0d47a1);
  color: white;
  font-size: 16px;
  font-weight: bold;
  padding: 12px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  display: inline-block;
}

.check-loan-btn:hover {
  background: linear-gradient(135deg, #2196f3, #1565c0);
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.25);
}

.check-loan-btn:active {
  transform: scale(0.97);
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
/* Shake animation */
@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-5px); }
  40% { transform: translateX(5px); }
  60% { transform: translateX(-5px); }
  80% { transform: translateX(5px); }
  100% { transform: translateX(0); }
}

.shake {
  animation: shake 0.4s ease;
}
/* Red glow effect */
.input-error {
  border: 2px solid #f44336 !important;
  box-shadow: 0 0 8px #f44336;
}
/* üé≤ Dice container */
#diceBox {
  width: 80px;
  height: 80px;
  margin: 20px auto;
  background: #fff;
  border: 3px solid #333;
  border-radius: 12px;
  font-size: 30px;
  font-weight: bold;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: transform 0.6s ease;
}

/* Rolling animation */
.roll {
  animation: rollDice 0.3s linear infinite;
}

@keyframes rollDice {
  0%   { transform: rotate(0deg); }
  25%  { transform: rotate(90deg); }
  50%  { transform: rotate(180deg); }
  75%  { transform: rotate(270deg); }
  100% { transform: rotate(360deg); }
}

/* Pop-up effect when showing final number */
.lucky-popup {
  animation: popUp 0.6s ease forwards;
  color: #1976d2;
}

@keyframes popUp {
  0%   { transform: scale(0.2); opacity: 0; }
  60%  { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1); }
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* Contact Buttons */
.contact-btn {
  display: inline-block;
  margin: 8px;
  padding: 12px 18px;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  color: white;
  transition: transform 0.2s ease, opacity 0.3s;
}

.contact-btn:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

/* Specific colors */
.contact-btn.email {
  background: #1976d2; /* Blue */
}
.contact-btn.phone {
  background: #d32f2f; /* Red */
}
.contact-btn.whatsapp {
  background: #25d366; /* WhatsApp Green */
}
/* Initial hidden state */
.fade-in {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.8s ease-out, transform 0.8s ease-out;
}

/* Visible state */
.fade-in.visible {
  opacity: 1;
  transform: translateY(0);
}
/* show password css */
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
  margin-top: 10px;
  vertical-align: middle;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #388e3c; /* Green when active */
}

input:checked + .slider:before {
  transform: translateX(26px);
}

.toggle-label {
  margin-left: 60px;
  font-size: 14px;
  color: #333;
}
/* About Us Section */
#about {
  background: #f9f9f9;
  padding: 40px 20px;
  border-radius: 10px;
  margin: 20px auto;
  max-width: 900px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

#about h2 {
  text-align: center;
  font-size: 28px;
  color: #1976d2;
  margin-bottom: 20px;
  border-bottom: 2px solid #1976d2;
  display: inline-block;
  padding-bottom: 5px;
}

#about h3 {
  margin-top: 20px;
  font-size: 22px;
  color: #333;
  border-left: 4px solid #1976d2;
  padding-left: 10px;
}

#about p {
  font-size: 16px;
  line-height: 1.6;
  margin: 10px 0;
  color: #444;
}

#about ul {
  list-style: none;
  padding: 0;
}

#about ul li {
  background: #e3f2fd;
  margin: 8px 0;
  padding: 10px 12px;
  border-radius: 6px;
  font-size: 16px;
  color: #1976d2;
  transition: transform 0.2s ease, background 0.3s;
}

#about ul li:hover {
  transform: scale(1.05);
  background: #bbdefb;
}

/* About Logo/Image */
#about img {
  transition: transform 0.4s ease;
}

#about img:hover {
  transform: scale(1.1) rotate(3deg);
}
body {
  background-image: url("https://github.com/bony87/my-future-finder-chama-group/blob/main/ChatGPT%20Image%20Sep%2010,%202025,%2005_43_14%20PM.png?raw=true");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  margin: 0;
  font-family: Arial, sans-serif;
  position: relative;
  z-index: 0;
}

/* Overlay */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.8); /* White overlay, 80% opaque */
  z-index: -1; /* Push behind content */
}
/* Dice styling */
#diceBox {
  font-size: 70px;
  text-align: center;
  margin: 20px auto;
  width: 100px;
  height: 100px;
  line-height: 100px;
  border: 3px solid #1976d2;
  border-radius: 12px;
  background: white;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: transform 0.3s ease, background 0.3s ease;
}

/* Rolling spin */
#diceBox.roll {
  animation: rollDice 0.5s infinite;
}

@keyframes rollDice {
  0%   { transform: rotate(0deg);   }
  25%  { transform: rotate(90deg);  }
  50%  { transform: rotate(180deg); background:#ffeb3b; } /* yellow flash */
  75%  { transform: rotate(270deg); background:#4caf50; } /* green flash */
  100% { transform: rotate(360deg); background:#f44336; } /* red flash */
}


@keyframes rollDice {
  0%   { transform: rotate(0deg);   }
  25%  { transform: rotate(90deg);  }
  50%  { transform: rotate(180deg); }
  75%  { transform: rotate(270deg); }
  100% { transform: rotate(360deg); }
}


@keyframes rollDice {
  0%   { transform: rotate(0deg);   }
  25%  { transform: rotate(90deg);  }
  50%  { transform: rotate(180deg); }
  75%  { transform: rotate(270deg); }
  100% { transform: rotate(360deg); }
}
.spinner {
  display: none;
  border: 2px solid #f3f3f3;
  border-top: 2px solid white;
  border-radius: 50%;
  width: 14px;
  height: 14px;
  animation: spin 1s linear infinite;
  margin-left: 8px;
  vertical-align: middle;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* Container for the form */
#registerForm {
  width: 320px;
  margin: 30px auto;
  padding: 20px;
  border-radius: 8px;
  background: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  text-align: center;
  font-family: Arial, sans-serif;
}

/* Form Title */
#registerForm h3 {
  margin-bottom: 20px;
  color: #333;
  font-size: 20px;
}

/* Input fields */
#registerForm input {
  width: 90%;
  padding: 10px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 14px;
  transition: border 0.3s;
}

#registerForm input:focus {
  border-color: #1976d2;
  outline: none;
}

/* Register button */
#registerForm button {
  width: 95%;
  padding: 12px;
  margin-top: 15px;
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s;
}

#registerForm button:hover {
  background: #1565c0;
}

/* Back to services button */
.action-btn {
  display: inline-block;
  padding: 10px 18px;
  margin: 20px auto;
  border-radius: 6px;
  color: #fff;
  font-size: 14px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.3s;
}

.action-btn:hover {
  background: #b71c1c !important;
}
.summary-card {
  flex: 1;
  min-width: 220px;
  padding: 12px;
  background: #f4f6f9;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-weight: bold;
  color: #333;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.fade-out {
  animation: fadeOut 0.6s ease forwards;
}

@keyframes fadeOut {
  from { opacity: 1; transform: scale(1); }
  to { opacity: 0; transform: scale(0.97); }
}
.fade-in {
  animation: fadeIn 0.6s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.97); }
  to { opacity: 1; transform: scale(1); }
}
/* Popup Box */
.popup-box {
  background: white;
  padding: 20px 30px;
  border-radius: 10px;
  text-align: center;
  max-width: 350px;
  box-shadow: 0px 5px 15px rgba(0,0,0,0.3);
  animation: slideIn 0.5s ease forwards;
  transform: translateY(-30px);
  opacity: 0;
}

@keyframes slideIn {
  from { transform: translateY(-30px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}


/* General Button Styles */
.download-btn {
  margin-top: 10px;
  padding: 10px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  color: #fff;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.csv-btn {
  background: #388e3c;
}

.pdf-btn {
  background: #1976d2;
}

.latest-btn {
  background: #009688;
}

/* Toast Notification */
.toast {
  visibility: hidden;
  min-width: 250px;
  margin-left: -125px;
  background: #323232;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 12px;
  position: fixed;
  z-index: 9999;
  left: 50%;
  bottom: 30px;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.5s, bottom 0.5s;
}

.toast.show {
  visibility: visible;
  opacity: 1;
  bottom: 50px;
}

.download-btn {
  margin: 2px;
  padding: 6px 10px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  color: #fff;
}
.pdf-btn { background: #1976d2; }

/* General Card Layout */
.card {
  max-width: 800px;
  margin: 20px auto;
  padding: 20px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}

/* Buttons */
.action-btn {
  display: inline-block;
  margin: 6px 4px;
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  background: #00796b;
  color: white;
  transition: 0.2s;
}
.action-btn:hover { opacity: 0.9; }
.action-btn.primary { background: #1976d2; }
.action-btn.danger { background: #d32f2f; }

/* Spinner inside button */
.spinner {
  display: none;
  margin-left: 8px;
  border: 2px solid #f3f3f3;
  border-top: 2px solid white;
  border-radius: 50%;
  width: 14px;
  height: 14px;
  animation: spin 1s linear infinite;
  vertical-align: middle;
}
@keyframes spin { 100% { transform: rotate(360deg); } }

/* Password Input */
.password-container {
  display: flex;
  align-items: center;
  margin: 12px 0;
}
.password-container input {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
.password-container .toggle-eye {
  margin-left: 8px;
  cursor: pointer;
  font-size: 14px;
}

/* Info Box */
.info-box {
  margin: 20px 0;
  padding: 15px;
  background: #e3f2fd;
  border-left: 6px solid #1976d2;
  border-radius: 8px;
}

/* Tables */
.table-container {
  overflow-x: auto;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
}
table th, table td {
  border: 1px solid #ddd;
  padding: 8px;
}
table th {
  background: #00796b;
  color: white;
}
.highlight {
  background: #17da48 !important;
}

/* Download buttons */
.download-buttons {
  margin: 15px 0;
}
.download-btn {
  margin: 5px;
  padding: 8px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  color: white;
}
.csv-btn { background: #388e3c; }
.pdf-btn { background: #1976d2; }

/* Toast */
.toast {
  visibility: hidden;
  min-width: 250px;
  background: #323232;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 12px;
  position: fixed;
  z-index: 9999;
  left: 50%;
  bottom: 30px;
  transform: translateX(-50%);
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.5s, bottom 0.5s;
}
.toast.show {
  visibility: visible;
  opacity: 1;
  bottom: 50px;
}


  </style>
</head>

<body>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <!-- WhatsApp Contact Popup -->
<div id="whatsappOverlay" class="popup-overlay">
  <div class="popup-box" style="max-width:400px; text-align:left;">
    <h3>üí¨ Describe Your Issue</h3>
    <textarea id="whatsappMessage" rows="4" placeholder="Type your message here..." 
              style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; resize:none;"></textarea>
    <div style="margin-top:15px; text-align:right;">
      <button onclick="sendWhatsApp()" 
              style="padding:10px 16px; background:#25d366; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">
        üöÄ Send
      </button>
      <button onclick="closeWhatsAppForm()" 
              style="padding:10px 16px; background:#d32f2f; color:white; border:none; border-radius:6px; cursor:pointer;">
        ‚ùå Cancel
      </button>
    </div>
  </div>
</div>

<!-- Custom Popup -->
<div id="popup" class="popup-overlay">
  <div id="popupBox" class="popup-box">
    <h3 id="popupTitle"></h3>
    <p id="popupMessage"></p>
    <button class="popup-btn" onclick="closePopup()">OK</button>
  </div>
</div>
<!-- Logo at the Top -->
<div style="margin:20px 0; text-align:center;">
  <img src="https://github.com/bony87/my-future-finder-chama-group/blob/main/ChatGPT%20Image%20Sep%2010,%202025,%2005_43_14%20PM.png?raw=true" 
       alt="Future Finders Logo" 
       style="width:150px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
  <p style="margin-top:10px; font-style:italic; color:#555;">Our Identity, Our Strength</p>
</div>

<!-- System Update Banner -->
<div id="systemBanner" style="display:none; background:#1976d2; color:white; text-align:center; padding:10px; font-weight:bold; position:fixed; top:0; left:0; width:100%; z-index:2000;">
  <span id="bannerMessage">üöÄ System Update: New features available!</span>
  <button onclick="closeBanner()" style="margin-left:20px; background:#fff; color:#1976d2; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">‚úñ Close</button>
</div>

<header>
  <h1>üåç Future Finders Chama Group</h1>
  <p>Empowering our members through savings, merry-go-round, and loans.</p>
</header>

<!-- NAVIGATION -->
<div id="navButtons">
  <a class="nav-btn" onclick="simulateAction(this,'home')">üè† Home <span class="spinner"></span></a>
  <a class="nav-btn" onclick="simulateAction(this,'about')">‚ÑπÔ∏è About Us <span class="spinner"></span></a>
 <a class="nav-btn" onclick="simulateAction(this,'membership')">üë• Membership <span class="spinner"></span></a>
 <a class="nav-btn" onclick="simulateAction(this,'picker')">üé≤ Pick Number <span class="spinner"></span></a>
  <a class="nav-btn" onclick="simulateAction(this,'services')">üíº Services <span class="spinner"></span></a>
  <a class="nav-btn" onclick="simulateAction(this,'updates')">
  üì∞ News 
  <span id="newsBadge" style="display:none; color:red; font-weight:bold; margin-left:5px;">‚óè</span>
  <span class="spinner"></span>
</a>

 <a class="nav-btn" onclick="simulateAction(this,'loginForm')">üîë Member Login <span class="spinner"></span></a>


  <a class="nav-btn" onclick="simulateAction(this,'adminLogin')">‚öôÔ∏è Admin <span class="spinner"></span></a>
 <a class="nav-btn" onclick="simulateAction(this,'contact')">üìû Contact <span class="spinner"></span>
</a>
<a id="backBtn" class="nav-btn" style="display:none; background:#d32f2f;"
   onclick="showAllButtons()">‚¨ÖÔ∏è Back to Menu <span class="spinner"></span></a>


</div>

<!-- Sections -->
<!-- üíº Services -->
<section id="services">
  <h2>üíº Our Services</h2>
  <ul style="list-style:none; padding:0; font-size:16px;">
    <li>üí∞ <b>Monthly Savings:</b> Contribute consistently and grow your financial discipline.</li>
    <li>üìä <b>Group Contributions:</b> Transparent tracking of all members' contributions.</li>
    <li>üè¶ <b>Loan Services:</b> Apply for loans based on your savings history and eligibility.</li>
    <li>üé≤ <b>Lucky Number Draw:</b> Fun reward system to encourage participation.</li>
    <li>üì∞ <b>System Updates:</b> Get notified instantly about changes and new features.</li>
    <li>ü§ù <b>Member Support:</b> Assistance via WhatsApp, phone, or email directly from the app.</li>
  </ul>

  <!-- Optional Buttons -->
  <div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">

  <!-- Register Button -->
  <a class="action-btn" style="background:#388e3c;" 
     onclick="simulateAction(this,'membership')">
    üìù Register as Member <span class="spinner"></span>
  </a>

  <!-- Contact Button -->
  <a class="action-btn" style="background:#1976d2;" 
     onclick="simulateAction(this,'contact')">
    üìû Contact Support <span class="spinner"></span>
  </a>
<!-- Back Button -->
  <a class="action-btn" style="background:#d32f2f; margin-top:15px;" 
     onclick="simulateAction(this,'services')">
    ‚¨ÖÔ∏è Back to Services <span class="spinner"></span>
  </a>
</div>
</section>



<section id="updates">
  <h2>üì∞ News & Updates</h2>
  <div id="newsFeed" style="margin-top:15px;">
    <p style="color:gray;">No updates yet.</p>
  </div>
</section>



  
</section>


<!-- Contact -->
<section id="contact">
  <h2>üìû Contact Us</h2>
  <button class="contact-btn email" onclick="contactEmail()">üìß Email Us</button>
  <button class="contact-btn phone" onclick="contactPhone()">üìû Call Us</button>
  <button class="contact-btn whatsapp" onclick="contactWhatsApp()">üí¨ WhatsApp Chat</button>
  
</section>

<section id="home" class="active">
  <h2>üè† Home</h2>
  <p>Welcome to Future Finders Chama. Together we save, invest, and grow.</p>
</section>
<!-- Random Picker -->
<section id="picker">
  <h2>üéâ Random Number Picker</h2>

  <!-- Select member -->
<label for="memberSelect"><b>Select Your Name:</b></label>
<select id="memberSelect" required>
  <option value="">-- Choose your name --</option>
  <option>BONIFACE CHELLUGET</option>
  <option>HILDA ODERO</option>
  <option>JOEL EGESA</option>
  <option>SHALIK SHIVERENGE</option>
  <option>EVERLINE MAINA</option>
  <option>ELVIS KAMASH</option>
  <option>JULIUS KEBASO</option>
  <option>CHRISTINE PIUS</option>
  <option>EDNAH NANCY</option>
  <option>JACKIENYARANGI</option>
  <option>JUDITH OMWOYO</option>
  <option>JANET NYAKUNDI</option>
  <option>ANASTANCIA OMWOYO</option>
  <option>PIUS NYAKUNDI</option>
  <option>SAMUEL OYUGI</option>
  <option>PURITY MOMANYI</option>
  <option>KEFFA MOMANYI</option>
  <option>KENNEDY MUTAYI</option>
  <option>MIKE MORRIS</option>
  <option>DAVY OMBATI</option>
  <option>FAITH MOKOGI</option>
  <option>SADLER KARAN</option>
  <option>SHARON CHEPTOO</option>
  <option>SHAMIM KAMASH</option>
  <option>CLAUDIA MORAA</option>
  <option>ESTHER OBEGI</option>
</select>



  <!-- Choose send method -->
  <div style="margin: 10px 0;">
    
    <label><input type="radio" name="sendOption" value="whatsapp"> Send via WhatsApp üí¨</label>
  </div>

  <!-- Pick button -->
  <a class="action-btn" id="pickBtn" onclick="pickNumber()">
  Pick Lucky Number <span class="spinner"></span>
</a>
<div id="diceBox">üé≤</div>
<div id="result" style="text-align:center; font-size:18px; margin-top:10px;"></div>
<audio id="diceSound" src="dice-roll.mp3" preload="auto"></audio>


  <p id="result"></p>
</section>


  <!-- ‚ÑπÔ∏è About Us -->
<section id="about">
  <h2>‚ÑπÔ∏è About Us</h2>
  <p>
    Welcome to <b>Future Finders Chama Group</b> ‚Äì a community of dedicated individuals 
    who believe in the power of <b>saving, supporting, and growing together</b>.
  </p>

  <!-- Mission & Vision -->
  <h3>üåü Our Mission</h3>
  <p>To empower members through savings, merry-go-round, and access to loans for financial growth.</p>

  <h3>üëÅÔ∏è Our Vision</h3>
  <p>A financially independent community where members grow together and achieve prosperity.</p>

  <!-- Core Values -->
  <h3>üí° Our Values</h3>
  <ul>
    <li>ü§ù Unity & Teamwork</li>
    <li>üìà Growth & Prosperity</li>
    <li>üí∞ Financial Discipline</li>
    <li>üåç Community Empowerment</li>
  </ul>

  <!-- Leadership -->
  <h3>üßë‚Äçüíº Our Leadership</h3>
  <p>
    Founded by <b>BONIFACE KAISER</b>, with a dedicated team of members 
    who work together to ensure transparency, growth, and unity.
  </p>

  <!-- History -->
  <h3>üìú Our Journey</h3>
  <p>
    Established in <b>2024 JANUARY</b>, Future Finders Chama began as a small savings group. 
    Today, it has grown into a vibrant community offering savings, loans, and investments to its members.
  </p>

  <!-- Optional Logo -->
  <div style="margin:20px 0; text-align:center;">
    <img src="logo.png" alt="Chama Logo" style="width:150px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <p style="margin-top:10px; font-style:italic; color:#555;">Our Identity, Our Strength</p>
  </div>
</section>



<!-- ‚öôÔ∏è Admin Login -->

  
  <section id="adminLogin">
  <h2>‚öôÔ∏è Admin Login</h2>
  <input type="text" id="adminUser" placeholder="Admin Name">
  
  
  <!-- Admin Password -->
<div class="password-container">
  <input type="password" id="adminPass" placeholder="Admin Password">
  <span class="toggle-eye" onclick="togglePassword('adminPass', this)">üëÅÔ∏è</span>
</div>
<a class="action-btn" id="adminBtn" onclick="adminLogin()">
    Admin Login <span class="spinner"></span>
  </a>
  <p id="adminLoginMessage"></p>
  </section>

<!-- Admin Panel (hidden until login) -->
 <!-- Logo at the Top -->
<div style="margin:20px 0; text-align:center;">
  <img src="https://github.com/bony87/my-future-finder-chama-group/blob/main/ChatGPT%20Image%20Sep%2010,%202025,%2005_43_14%20PM.png?raw=true" 
       alt="Future Finders Logo" 
       style="width:150px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
  <p style="margin-top:10px; font-style:italic; color:#555;">Our Identity, Our Strength</p>
</div>

<section id="admin" style="display:none;">
  <h2>üõ† Admin Panel</h2>

  <!-- Admin logout -->
<button id="logoutBtn" onclick="adminLogout()" 
        style="margin-bottom:15px; padding:10px; background:#d32f2f; color:white; border:none; border-radius:5px; cursor:pointer; position:relative;">
  üö™ Logout 
  <span class="spinner" style="display:none; margin-left:8px; border:2px solid #f3f3f3; border-top:2px solid white; border-radius:50%; width:14px; height:14px; animation: spin 1s linear infinite; vertical-align:middle;"></span>
</button>
<button onclick="showAvailableNumbers()" 
        style="margin-top:10px; padding:8px 14px; background:#388e3c; color:white; border:none; border-radius:5px; cursor:pointer;">
  üìã Show Available Numbers
</button>

  <!-- Admin Controls -->
  <h3>üë§ Member Management</h3>
  <input type="text" id="loanSearch" placeholder="üîç Search loans by name, phone, or status..." 
       onkeyup="filterLoans()" 
       style="width:95%; padding:8px; margin:10px 0; border:1px solid #ccc; border-radius:5px;">
<select id="loanStatusFilter" onchange="filterLoans()" 
        style="padding:8px; margin:10px 0; border:1px solid #ccc; border-radius:5px;">
  <option value="">üìÇ Show All</option>
  <option value="Pending">‚è≥ Pending</option>
  <option value="Approved">‚úÖ Approved</option>
  <option value="Rejected">‚ùå Rejected</option>
</select>
<button onclick="exportLoans()" 
        style="padding:8px 12px; margin:10px 0; background:#1976d2; color:white; border:none; border-radius:5px; cursor:pointer;">
  üìÇ Export Loans (CSV)
</button>

<h3>üìú Loan Applications</h3>
<table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
  <thead style="background:#1976d2; color:white;">
    <tr>
      <th>Name</th>
      <th>Phone</th>
      <th>Qualified Loan</th>
      <th>Requested Amount</th>
      <th>ID Number</th>
      <th>Period</th>
      <th>Repayment</th>
      <th>Date</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="adminLoanBody">
    <tr><td colspan="10" style="color:gray;">No applications yet.</td></tr>
  </tbody>
</table>

  <!-- View Picked Numbers -->
<button onclick="togglePickedNumbers()" 
        style="padding:10px; margin:5px; background:#1976d2; color:white; border:none; border-radius:5px; cursor:pointer;">
  üé≤ View Picked Numbers
</button>

<!-- Lucky numbers table (hidden initially) -->
<div id="pickedNumbersTable" style="display:none; margin-top:20px;">
  <h3>üé≤ Picked Lucky Numbers</h3>

  <!-- Download CSV button -->
  <button onclick="downloadPickedNumbers()" 
          style="margin-bottom:10px; padding:8px 12px; background:#388e3c; color:white; border:none; border-radius:5px; cursor:pointer;">
    ‚¨áÔ∏è Download CSV
  </button>
<!-- Reset Picked Numbers button -->
<button onclick="resetPickedNumbers()" 
        style="margin-bottom:10px; padding:8px 12px; background:#d32f2f; color:white; border:none; border-radius:5px; cursor:pointer;">
  üóëÔ∏è Reset Picked Numbers
</button>
  <table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
    <thead style="background:#1976d2; color:white;">
      <tr>
        <th>Member</th>
        <th>Lucky Number</th>
      </tr>
    </thead>
    <tbody id="pickedNumbersBody">
      <tr><td colspan="2" style="color:gray;">No numbers picked yet.</td></tr>
    </tbody>
  </table>
</div>
<div id="pendingMembersPanel" style="margin-top:20px;">
  <h3>üìù Pending Member Registrations</h3>
  <table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
    <thead style="background:#00796b; color:white;">
      <tr>
        <th>Name</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="pendingMembersBody">
      <tr><td colspan="5" style="color:gray;">No pending registrations.</td></tr>
    </tbody>
  </table>
</div>

<!-- System Updates Section -->
<h3>üöÄ System Updates</h3>

<textarea id="updateMessage" placeholder="Type new update..." 
          style="width:90%; padding:10px; margin-bottom:10px;"></textarea><br>

<button onclick="postUpdate()" 
        style="padding:10px; background:#1976d2; color:white; border:none; border-radius:5px; cursor:pointer;">
  üì¢ Post Update
</button>

<div id="memberSelectionBox" style="display:none; margin-top:8px;">
  <label><b>Select Members:</b></label><br>
  <select id="memberSelectMulti" multiple size="10" style="width:260px; padding:6px;">
    <!-- Members will be loaded dynamically -->
  </select>
  <br>
  <button type="button" onclick="selectAllMembers()" 
          style="margin-top:5px; padding:5px 10px; background:#388e3c; color:white; border:none; border-radius:4px; cursor:pointer;">
    ‚úÖ Select All
  </button>
  <!-- üîç Search bar -->
  <input type="text" id="memberSearch" onkeyup="filterMembers()" 
         placeholder="üîç Search member..." 
         style="width:260px; padding:6px; margin-bottom:6px;">
  <button type="button" onclick="clearAllMembers()" 
          style="margin-top:5px; padding:5px 10px; background:#d32f2f; color:white; border:none; border-radius:4px; cursor:pointer;">
    ‚ùå Clear All
  </button>
  <p style="font-size:12px; color:gray; margin-top:5px;">(Hold CTRL/SHIFT to select multiple manually)</p>
</div>


 <label style="display:block; margin-top:8px;">
  <input type="checkbox" id="sendWhatsAppUpdate" onchange="toggleMemberSelection()"> 
  üì≤ Send WhatsApp notification to members
</label>


<!-- Updates History Table -->
<div style="margin-top:20px;">
  <h4>üìú Past Updates</h4>
  <table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
    <thead style="background:#1976d2; color:white;">
      <tr>
        <th>All Updates (Click to Expand/Collapse)</th>
      </tr>
    </thead>
    <tbody id="updateHistoryBody">
      <tr><td style="color:gray;">No updates posted yet.</td></tr>
    </tbody>
  </table>
</div>
<div id="adminSummary" style="display:flex; gap:15px; margin:15px 0; flex-wrap:wrap;">
  <div class="summary-card" id="totalMembersCard">üë• Total Members: 0</div>
  <div class="summary-card" id="totalSavingsCard">üí∞ Total Savings: Ksh 0</div>
  <div class="summary-card" id="totalLoansCard">üìë Total Loans: 0</div>
  <div class="summary-card" id="loanBreakdownCard">üìä Loan Status: 0 Pending / 0 Approved / 0 Rejected</div>
</div>



</section>


  

<section id="membership" style="display:none;">
  <h2>üë• Membership</h2>
  <p>If you‚Äôre new, please register. If already a member, log in.</p>

  <!-- Eligibility Info -->
  <div style="margin:20px auto; padding:15px; background:#e3f2fd; border-left:6px solid #1976d2; border-radius:8px; max-width:600px;">
    <h3 style="color:#1976d2; margin-bottom:10px;">üìå Membership & Loan Eligibility</h3>
    <p style="line-height:1.6; color:#333;">
      ‚úÖ <b>Loan Qualification:</b> A member must have saved at least <b>Ksh 1,500</b>.<br><br>
      ‚úÖ <b>Official Membership:</b> To become an official member, you must be active for a minimum of <b>4 months</b> in the chama.<br><br>
      ‚úÖ <b>Commitment:</b> Members are expected to contribute consistently and maintain good financial discipline.<br><br>
      ‚úÖ <b>Support & Trust:</b> Being a member means supporting one another and upholding transparency within the group.
    </p>
  </div>

  <!-- Registration Form -->
  <div id="registerForm">
    <h3>üìù New Member Registration</h3>
    <input type="text" id="regName" placeholder="Full Name" required>
    <input type="text" id="regPhone" placeholder="Phone Number" required>
    <input type="password" id="regPass" placeholder="Set Password" required>
    <button onclick="registerMember()">Register</button>
  </div>

  <a class="action-btn" style="background:#d32f2f; margin-top:15px;" 
   onclick="simulateAction(this,'services')">
    ‚¨ÖÔ∏è Back to Services <span class="spinner"></span>
  </a>
</section>

   
  


<!-- Member Login -->
<section id="loginForm">
  <h2>üîë Member Login</h2>
   <h1>Chama Savings & Loan System</h1>
  <label for="memberName"><b>Select Your Name:</b></label>
  <select id="memberName" required>
    <option value="">-- Choose your name --</option>
    <option>BONIFACE CHELLUGET</option>
    <option>HILDA ODERO</option>
    <option>JOEL EGESA</option>
    <option>SHALIK SHIVERENGE</option>
    <option>EVERLINE MAINA</option>
    <option>ELVIS KAMASH</option>
    <option>JULIUS KEBASO</option>
    <option>CHRISTINE PIUS</option>
    <option>EDNAH NANCY</option>
    <option>JACKIE NYARANGI</option>
    <option>JUDITH OMWOYO</option>
    <option>JANET NYAKUNDI</option>
    <option>ANASTANCIA OMWOYO</option>
    <option>PIUS NYAKUNDI</option>
    <option>SAMUEL OYUGI</option>
    <option>PURITY MOMANYI</option>
    <option>KEFFA MOMANYI</option>
    <option>KENNEDY MUTAYI</option>
    <option>MIKE MORRIS</option>
    <option>DAVY OMBATI</option>
    <option>FAITH MOKOGI</option>
    <option>SADLER KARAN</option>
    <option>SHARON CHEPTOO</option>
    <option>SHAMIM KAMASH</option>
    <option>CLAUDIA MORAA</option>
    <option>ESTHER OBEGI</option>
    <option>DENNIS KIEYA</option>
     <option>BRIGIDE NYABERI</option>
    
  </select>
<!-- Member Password -->
<div class="password-container">
  <input type="password" id="memberPass" placeholder="Enter your phone number or password created by you">
  <span class="toggle-eye" onclick="togglePassword('memberPass', this)">üëÅÔ∏è Show password</span>
</div>

  <!-- Spinner already inside the button -->
  <a class="action-btn" id="memberLoginBtn" onclick="login()">Login <span class="spinner"></span></a>
  
  <p id="loginMessage"></p>
</section>



<!-- Dashboard -->
<div id="dashboard">
  <h3>Welcome, <span id="memberDisplay"></span>!</h3>
  <a class="action-btn" onclick="showCurrentSavings()">üí∞ View Current Savings</a>
  <a class="action-btn" onclick="showMonthlySavings()">üìä View Monthly Savings</a>
  <button class="check-loan-btn" onclick="checkLoan()">üîç Check Loan Eligibility</button>

<!-- üö™ Member Logout -->
<button id="memberLogoutBtn" class="action-btn" style="background:#d32f2f; margin-top:15px; position:relative;"
        onclick="memberLogout()">
  üö™ Logout
  <span class="spinner" style="display:none; margin-left:8px; border:2px solid #f3f3f3; border-top:2px solid white; border-radius:50%; width:14px; height:14px; animation: spin 1s linear infinite; vertical-align:middle;"></span>
</button>


<div id="loanMessage" style="margin-top:15px; font-weight:bold; color:#004d40;"></div>
  <div id="allContributions" style="margin-top:20px;">
    <!-- Eligibility Info Box -->
  <div style="margin:20px auto; padding:15px; background:#e3f2fd; border-left:6px solid #1976d2; border-radius:8px; max-width:600px;">
    <h3 style="color:#1976d2; margin-bottom:10px;">üìå Membership & Loan Eligibility</h3>
    <p style="line-height:1.6; color:#333;">
      ‚úÖ <b>Loan Qualification:</b> A member must have saved at least <b>Ksh 1,500</b>.<br><br>
      ‚úÖ <b>Official Membership:</b> To become an official member, you must be active for a minimum of <b>4 months</b> in the chama.<br><br>
      ‚úÖ <b>Commitment:</b> Members are expected to contribute consistently and maintain good financial discipline.<br><br>
      ‚úÖ <b>Support & Trust:</b> Being a member means supporting one another and upholding transparency within the group.
    </p>
  </div>
  <h4>üìä Group Contributions</h4>
<table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
  <thead style="background:#00796b; color:white;">
    <tr>
      <th>NAME</th>
      <th>JAN</th>
      <th>FEB</th>
      <th>MAR</th>
      <th>APR</th>
      <th>MAY</th>
      <th>JUNE</th>
      <th>JULY</th>
      <th>AUG</th>
      <th>SEPT</th>
      <th>OCT</th>
      <th>NOV</th>
      <th>DEC</th>
      <th style="background:#17da48;">TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>BONIFACE CHELLUGET</td><td>500</td><td>500</td><td>500</td><td>500</td><td>500</td><td>500</td><td>500</td><td>500</td><td>500</td><td>0</td><td>0</td><td>0</td><td><b>4500</b></td></tr><td>
    <tr><td>HILDA ODERO</td><td>400</td><td>200</td><td>100</td><td>200</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>900</b></td></tr>
    <tr><td>JOEL EGESA</td><td>200</td><td>0</td><td>20</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>500</td><td>0</td><td>0</td><td>0</td><td><b>720</b></td></tr>
    <tr><td>SHALIK SHIVERENGE</td><td>250</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>250</b></td></tr>
    <tr><td>EVERLINE MAINA</td><td>250</td><td>150</td><td>250</td><td>200</td><td>200</td><td>250</td><td>200</td><td>100</td><td>150</td><td>0</td><td>0</td><td>0</td><td><b>1750</b></td></tr>
    <tr><td>ELVIS KAMASH</td><td>250</td><td>150</td><td>250</td><td>50</td><td>200</td><td>150</td><td>50</td><td>250</td><td>150</td><td>0</td><td>0</td><td>0</td><td><b>1500</b></td></tr>
    <tr><td>JULIUS KEBASO</td><td>450</td><td>300</td><td>500</td><td>500</td><td>400</td><td>500</td><td>400</td><td>500</td>300<td>0</td><td>0</td><td>0</td><td>0</td><td><b>3800</b></td></tr>
    <tr><td>CHRISTINE PIUS</td><td>50</td><td>150</td><td>250</td><td>150</td><td>0</td><td>0</td><td>0</td><td>0</td><td>50</td><td>0</td><td>0</td><td>0</td><td><b>650</b></td></tr>
    <tr><td>EDNAH NANCY</td><td>250</td><td>100</td><td>100</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>50</td><td>0</td><td>0</td><td>0</td><td><b>500</b></td></tr>
    <tr><td>JACKIENYARANGI</td><td>200</td><td>200</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>50</td><td>0</td><td>0</td><td>0</td><td><b>450</b></td></tr>
    <tr><td>JUDITH OMWOYO</td><td>300</td><td>300</td><td>300</td><td>0</td><td>0</td><td>0</td><td>0</td><td>100</td><td>150</td><td>0</td><td>0</td><td>0</td><td><b>1150</b></td></tr>
    <tr><td>JANET NYAKUNDI</td><td>150</td><td>0</td><td>100</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>250</b></td></tr>
    <tr><td>ANASTANCIA OMWOYO</td><td>250</td><td>150</td><td>200</td><td>200</td><td>200</td><td>150</td><td>200</td><td>250</td><td>150</td><td>0</td><td>0</td><td>0</td><td><b>1650</b></td></tr>
    <tr><td>PIUS NYAKUNDI</td><td>150</td><td>200</td><td>200</td><td>0</td><td>100</td><td>100</td><td>100</td><td>150</td><td>50</td><td>0</td><td>0</td><td>0</td><td><b>1000</b></td></tr>
    <tr><td>SAMUEL OYUGI</td><td>400</td><td>300</td><td>500</td><td>400</td><td>400</td><td>500</td><td>400</td><td>500</td><td>200</td><td>0</td><td>0</td><td>0</td><td><b>3700</b></td></tr>
    <tr><td>PURITY MOMANYI</td><td>200</td><td>200</td><td>1200</td><td>950</td><td>800</td><td>400</td><td>350</td><td>100</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>4200</b></td></tr>
    <tr><td>KEFFA MOMANYI</td><td>250</td><td>150</td><td>200</td><td>200</td><td>200</td><td>250</td><td>200</td><td>150</td><td>150</td><td>0</td><td>0</td><td>0</td><td><b>1800</b></td></tr>
    <tr><td>KENNEDY MUTAYI</td><td>750</td><td>450</td><td>750</td><td>600</td><td>600</td><td>750</td><td>600</td><td>750</td>450<td>0</td><td>0</td><td>0</td><td>0</td><td><b>5650</b></td></tr>
    <tr><td>MIKE MORRIS</td><td>0</td><td>0</td><td>100</td><td>50</td><td>0</td><td>0</td><td>0</td><td>150</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>300</b></td></tr>
    <tr><td>DAVY OMBATI</td><td>0</td><td>0</td><td>50</td><td>0</td><td>0</td><td>0</td><td>0</td><td>200</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>250</b></td></tr>
    <tr><td>FAITH MOKOGI</td><td>0</td><td>0</td><td>500</td><td>200</td><td>250</td><td>50</td><td>100</td><td>50</td><td>250</td><td>0</td><td>0</td><td>0</td><td><b>1400</b></td></tr>
    <tr><td>SADLER KARAN</td><td>0</td><td>0</td><td>200</td><td>200</td><td>150</td><td>50</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td><b>600</b></td></tr>
    <tr><td>SHARON CHEPTOO</td><td>0</td><td>0</td><td>0</td><td>0</td><td>250</td><td>150</td><td>150</td><td>100</td><td>100</td><td>0</td><td>0</td><td>0</td><td><b>750</b></td></tr>
    <tr><td>SHAMIM KAMASH</td><td>0</td><td>0</td><td>0</td><td>0</td><td>200</td><td>150</td><td>50</td><td>250</td><td>150</td><td>0</td><td>0</td><td>0</td><td><b>800</b></td></tr>
    <tr><td>CLAUDIA MORAA</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>100</td><td>400</td><td>300</td><td>200</td><td>0</td><td>0</td><td>0</td><td><b>900</b></td></tr>
  <tr><td>ESTHER OBEGI</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>500</td><td>300</td><td>0</td><td>0</td><td>0</td><td><b>800</b></td></tr>
  <tr><td>DENNIS KIEYA</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>50</td><td>0</td><td>0</td><td>0</td><td><b>50</b></td></tr>
  <tr><td>BRIGIDE NYABERI</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>50</td><td>0</td><td>0</td><td>0</td><td><b>50</b></td></tr>
  </tbody>
  </tbody>
  </tbody>
</table>
<!-- Download Options -->
<button onclick="downloadContributionsCSV()" class="download-btn csv-btn">
  ‚¨áÔ∏è Download Excel (CSV)
</button>

<button onclick="downloadContributionsPDF()" class="download-btn pdf-btn">
  ‚¨áÔ∏è Download PDF
</button>

<div id="latestContributions" style="margin-top:15px;">
  <button id="downloadLatestContributions" class="download-btn latest-btn" style="display:none;">
    ‚¨áÔ∏è Download Latest Contributions
  </button>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>



<!-- Loan Applications History -->
<div id="loanHistory" style="margin-top:30px;">
  <h3>üìú Loan Applications History</h3>
  <table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
    <thead style="background:#00796b; color:white;">
      <tr>
        <th>Name</th>
        <th>Phone</th>
        <th>Qualified Loan</th>
        <th>Requested Amount</th>
        <th>ID Number</th>
        <th>Date</th>
        <th>Status</th>
        <th>Receipt</th> <!-- ‚úÖ Added -->
      </tr>
    </thead>

    <tbody id="loanHistoryBody">
      <!-- Example loan row -->
      <tr>
        <td>Boniface Chelluget</td>
        <td>0713953004</td>
        <td>Ksh 5,000</td>
        <td>Ksh 3,000</td>
        <td>12345678</td>
        <td>16-09-2025</td>
        <td>Pending</td>
        <td>
          <button onclick="downloadLoanReceipt('Boniface Chelluget','0713953004','5000','3000','12345678','16-09-2025','Pending')" 
                  class="download-btn pdf-btn" style="padding:4px 8px; font-size:12px;">
            üßæ Receipt
          </button>
        </td>
      </tr>

      <!-- Default row if no applications -->
      <tr><td colspan="8" style="color:gray;">No loan applications yet.</td></tr>
    </tbody>
  </table>
</div>

</div>

</div>
</div>


</section>



<footer style="position:fixed; bottom:0; width:100%; background:#111; padding:10px 0; text-align:center; color:white; z-index:1000;">
  <div class="footer-marquee">
    <span class="glow">üåü FOUNDER: BONIFACE KAISER üåü</span>
  </div>
</footer>




<script>
 



// üë• Members data (hardcoded + savings history)
const members = {
  "BONIFACE CHELLUGET": { phone: "0713953004", savings: 4500, monthly: [500, 500, 500, 500, 500, 500, 500,500,500] },
  "HILDA ODERO": { phone: "0795341320", savings: 900, monthly: [400, 200, 100, 200] },
  "JOEL EGESA": { phone: "0768039551", savings: 1220, monthly: [200, 0, 20, 1000] },
  "SHALIK SHIVERENGE": { phone: "0746277086", savings: 250, monthly: [250, 0, 0] },
  "EVERLINE MAINA": { phone: "0701360180", savings: 1700, monthly: [250, 150, 250, 200, 200, 250, 200, 100, 0] },
  "ELVIS KAMASH": { phone: "0798577851", savings: 1450, monthly: [250, 150, 250, 50, 200, 150, 50, 250, 100] },
  "JULIUS KEBASO": { phone: "0705296154", savings: 3750, monthly: [450, 300, 500, 500, 400, 500, 400, 500,200] },
  "CHRISTINE PIUS": { phone: "0115603500", savings: 600, monthly: [50, 150, 250, 150, 0, 0, 0, 0, 0] },
  "EDNAH NANCY": { phone: "0717684177", savings: 450, monthly: [250, 100, 100, 0, 0, 0, 0, 0, 0] },
  "JACKIENYARANGI": { phone: "0790206224", savings: 400, monthly: [200, 200, 0, 0, 0, 0, 0, 0, 0] },
  "JUDITH OMWOYO": { phone: "0741939235", savings: 1050, monthly: [300, 300, 300, 0, 0, 0, 0, 100, 0] },
  "JANET NYAKUNDI": { phone: "0706753288", savings: 250, monthly: [150, 0, 100, 0, 0, 0, 0, 0, 0] },
  "ANASTANCIA OMWOYO": { phone: "0748442547", savings: 1600, monthly: [250, 150, 200, 200, 200, 150, 100, 250, 0] },
  "PIUS NYAKUNDI": { phone: "0716845165", savings: 950, monthly: [150, 200, 200, 0, 100, 100, 100, 150, 0] },
  "SAMUEL OYUGI": { phone: "0796860412", savings: 3600, monthly: [400, 300, 500, 400, 400, 500, 400, 500, 0] },
  "PURITY MOMANYI": { phone: "0103155480", savings: 4200, monthly: [200, 200, 1200, 950, 800, 400, 350, 100, 0] },
  "KEFFA MOMANYI": { phone: "0759237482", savings: 1750, monthly: [250, 200, 200, 200, 200, 250, 200, 150, 0] },
  "KENNEDY MUTAYI": { phone: "0724124735", savings: 5250, monthly: [750, 450, 750, 600, 600, 750, 600, 750, 0] },
  "MIKE MORRIS": { phone: "0115570301", savings: 300, monthly: [0, 0, 100, 50, 0, 0, 0, 150, 0] },
  "DAVY OMBATI": { phone: "0793547166", savings: 250, monthly: [0, 0, 50, 0, 0, 0, 200, 0, 0] },
  "FAITH MOKOGI": { phone: "0706918919", savings: 1150, monthly: [0, 0, 500, 200, 250, 50, 100, 50, 0] },
  "SADLER KARAN": { phone: "0791730719", savings: 600, monthly: [0, 0, 200, 200, 150, 50, 0, 0, 0] },
  "SHARON CHEPTOO": { phone: "0768675656", savings: 650, monthly: [0, 0, 0, 0, 250, 150, 150, 100, 50] },
  "SHAMIM KAMASH": { phone: "0725979420", savings: 650, monthly: [0, 0, 0, 0, 200, 150, 50, 250] },
  "CLAUDIA MORAA": { phone: "0741520782", savings: 800, monthly: [0, 0, 0, 0, 0, 100, 400, 300, 0] },
  "ESTHER OBEGI": { phone: "0748845363", savings: 500, monthly: [0, 0, 0, 0, 0, 0, 0, 500, 0] },
   "DENNIS KIEYA": { phone: "@dennis12", savings: 50, monthly: [0, 0, 0, 0, 0, 0, 0, 0, 50] },
   "BRIGIDE NYABERI": { phone: "Brigide", savings: 50, monthly: [0, 0, 0, 0, 0, 0, 0, 0, 50] }
  
};


// üîÑ Simulate loading action (button + spinner + section switch)
function simulateAction(button, sectionId) {
  let spinner = button.querySelector(".spinner");

  // Show spinner
  if (spinner) spinner.style.display = "inline-block";
  button.style.pointerEvents = "none";

  setTimeout(() => {
    if (spinner) spinner.style.display = "none";
    button.style.pointerEvents = "auto";

    // Hide all sections
    document.querySelectorAll("section, #dashboard, #admin, #newsSection").forEach(sec => {
      sec.style.display = "none";
    });

    // Hide all nav buttons except the clicked one
    document.querySelectorAll("#navButtons .nav-btn").forEach(btn => {
      btn.style.display = "none";
    });
    button.style.display = "inline-block"; // keep clicked one

    // Show selected section
    let target = document.getElementById(sectionId);
    if (target) {
      target.style.display = "block";

      // ‚úÖ Special handling for News Section
      if (sectionId === "newsSection") {
        loadNews();
        markNewsRead();
      }
    } else {
      console.error("‚ùå Section not found:", sectionId);
    }

    // ‚úÖ Show Back button
    document.getElementById("backBtn").style.display = "inline-block";
  }, 800); // 0.8 sec loading effect
}


function showAllButtons() {
  // Show all nav buttons again
  document.querySelectorAll("#navButtons .nav-btn").forEach(btn => {
    btn.style.display = "inline-block";
  });

  // Hide the back button
  document.getElementById("backBtn").style.display = "none";

  // Hide all sections except Home
  document.querySelectorAll("section, #dashboard, #admin, #newsSection").forEach(sec => {
    sec.style.display = "none";
  });
  document.getElementById("home").style.display = "block"; // default back to Home
}

function delayedShowAllButtons(btn) {
  // Add loading effect
  btn.querySelector(".spinner").textContent = " ‚è≥";

  // Disable button while loading
  btn.style.pointerEvents = "none";

  // Wait 2 seconds, then run the function
  setTimeout(() => {
    btn.querySelector(".spinner").textContent = "";
    btn.style.pointerEvents = "auto";
    showAllButtons();
  }, 2000);
}

// üîî Show Popup
function showPopup(type, title, message) {
  const popup = document.getElementById("popup");
  const box = document.getElementById("popupBox");

  document.getElementById("popupTitle").innerText = title;
  document.getElementById("popupMessage").innerText = message;

  // Reset styles
  box.className = "popup-box";

  if (type === "success") {
    box.classList.add("popup-success");
  } else if (type === "error") {
    box.classList.add("popup-error");
  }

  popup.style.display = "flex";

  // Auto-close after 5s
  setTimeout(() => {
    closePopup();
  }, 5000);
}

// ‚ùå Close Popup
function closePopup() {
  document.getElementById("popup").style.display = "none";
}
// üîê Member Login
function login() { 
  let btn = document.getElementById("memberLoginBtn");
  let spinner = btn.querySelector(".spinner");
  let name = document.getElementById("memberName").value.trim();
  let pass = document.getElementById("memberPass").value.trim();
  let msg = document.getElementById("loginMessage");

  spinner.style.display = "inline-block";

  setTimeout(() => {
    spinner.style.display = "none";

    if (!name || !pass) {
      msg.innerText = "‚ö†Ô∏è Please select your name and enter your phone number / password created.";
      return;
    }

    // ‚úÖ Check hardcoded members
    if (members[name] && members[name].phone === pass) {
      msg.innerText = "";
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
      document.getElementById("memberDisplay").innerText = name;
// ===========================
// üîπ Keyboard Support for Member Login
// ===========================
document.querySelectorAll("#loginForm input").forEach(input => {
  input.addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      login(); // call your member login function
    }
    if (event.key === "Escape") {
      document.getElementById("memberName").value = "";
      document.getElementById("memberPass").value = "";
    }
  });
});
      // Load loan history
      loadMemberLoanHistory(name);

      showPopup("success", "Welcome Back üéâ", `Hello ${name}, glad to see you again!`);
      return;
    }

    // üîê Check approved members from localStorage
    let approved = JSON.parse(localStorage.getItem("approvedMembers")) || [];
    let member = approved.find(m => m.name === name);

    if (!member) {
      msg.innerText = "‚ùå You are not approved yet. Please wait for admin approval.";
      return;
    }

    if (member.phone !== pass) {
      msg.innerText = "‚ùå Invalid phone number.";
      return;
    }

    // ‚úÖ Successful login for approved member
    msg.innerText = "";
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
    document.getElementById("memberDisplay").innerText = name;

    loadMemberLoanHistory(name);

    showPopup("success", "Welcome üéâ", `Hello ${name}, you are now logged in!`);
  }, 1000);
}
// üí∞ Show current savings
function showCurrentSavings() {
  let name = document.getElementById("memberDisplay").innerText;
  if (!name || !members[name]) {
    alert("‚ö†Ô∏è Please log in first.");
    return;
  }
  alert("üí∞ Current Savings: KES " + members[name].savings);
}

// üìä Show monthly contributions
function showMonthlySavings() {
  let name = document.getElementById("memberDisplay").innerText;
  if (!name || !members[name]) {
    alert("‚ö†Ô∏è Please log in first.");
    return;
  }
  alert("üìä Monthly Contributions: " + members[name].monthly.join(", "));
}
// üè¶ Loan Eligibility Check
function checkLoan() { 
  let name = document.getElementById("memberDisplay").innerText;
  if (!name || !members[name]) {
    alert("‚ö†Ô∏è Please log in first.");
    return;
  }

  let totalSavings = members[name].savings;
  let loanResult = document.getElementById("loanMessage");
  loanResult.innerHTML = ""; 

  let loanAmount = 0, repaymentPeriod = "";

  // Qualification rules
  if (totalSavings < 1500) {
    loanResult.innerHTML = `‚ùå Sorry, ${name}, you are not yet eligible for a loan. Please keep on saving.`;
    return;
  } else if (totalSavings >= 1500 && totalSavings < 2000) {
    loanAmount = 1200;
    repaymentPeriod = "2 months";
  } else if (totalSavings >= 2000 && totalSavings < 3000) {
    loanAmount = 1800;
    repaymentPeriod = "2 months";
  } else if (totalSavings >= 3000 && totalSavings < 4000) {
    loanAmount = 2800;
    repaymentPeriod = "2.5 months";
  } else if (totalSavings >= 4000 && totalSavings < 5000) {
    loanAmount = 3500;
    repaymentPeriod = "3 months";
  } else if (totalSavings >= 5000 && totalSavings < 6500) {
    loanAmount = 4100;
    repaymentPeriod = "3.5 months";
  } else if (totalSavings >= 6500 && totalSavings < 7600) {
    loanAmount = 5000;
    repaymentPeriod = "5 months";
  } else if (totalSavings >= 7600) {
    let extraSteps = Math.floor((totalSavings - 7600) / 400);
    loanAmount = 5000 + (extraSteps * 200);
    repaymentPeriod = "6 months";
  }

  // Show result + Apply button
  loanResult.innerHTML = `
    ‚úÖ Congratulations, ${name}!<br>
    You qualify for a loan.<br><br>
    <b>Maximum Loan You Can Borrow:</b> Ksh ${loanAmount}<br>
    <b>Repayment Period:</b> ${repaymentPeriod}<br><br>
    <button onclick="showLoanForm('${name}', ${loanAmount}, '${repaymentPeriod}')" 
      style="padding:10px 15px; background:#1976d2; color:white; border:none; border-radius:5px; cursor:pointer;">
      üëâ Apply Now
    </button>
  `;
}
// üìù Loan Application Form
function showLoanForm(name, maxAmount, repaymentPeriod) {
  let phone = members[name].phone;

  let loanResult = document.getElementById("loanMessage");
  loanResult.innerHTML = `
    <h3>üìù Loan Application Form</h3>
    <form onsubmit="submitLoan(event, '${name}', ${maxAmount}, '${phone}', '${repaymentPeriod}')">
      
      <label><b>Name:</b></label><br>
      <input type="text" value="${name}" readonly style="width:90%; padding:8px; margin-bottom:10px;"><br>
      
      <label><b>Phone Number:</b></label><br>
      <input type="text" value="${phone}" readonly style="width:90%; padding:8px; margin-bottom:10px;"><br>
      
      <label><b>Maximum You Can Borrow:</b></label><br>
      <input type="text" value="Ksh ${maxAmount}" readonly style="width:90%; padding:8px; margin-bottom:10px;"><br>

      <label><b>Repayment Period:</b></label><br>
      <input type="text" value="${repaymentPeriod}" readonly style="width:90%; padding:8px; margin-bottom:10px;"><br>

      <label><b>Enter Amount You Wish to Apply:</b></label><br>
      <input type="number" id="applyAmount" min="500" max="${maxAmount}" required 
             placeholder="Enter amount (min 500, max ${maxAmount})" 
             style="width:90%; padding:8px; margin-bottom:10px;"><br>

      <label><b>ID Number:</b></label><br>
      <input type="number" id="loanId" required placeholder="Enter your ID Number" 
             minlength="7" maxlength="8" 
             oninput="if(this.value.length > 8) this.value = this.value.slice(0, 8);" 
             style="width:90%; padding:8px; margin-bottom:10px;"><br>

      <button type="submit" 
        style="margin-top:10px; padding:10px; background:#388e3c; color:white; border:none; cursor:pointer;">
        Submit Application
      </button>
    </form>
  `;
}
// üì§ Handle Loan Submission
function submitLoan(event, name, maxAmount, phone, repaymentPeriod) {
  event.preventDefault();

  let applyAmount = parseInt(document.getElementById("applyAmount").value);
  let idNumber = document.getElementById("loanId").value.trim();

  // Validation
  if (isNaN(applyAmount) || applyAmount < 500 || applyAmount > maxAmount) {
    alert(`‚ùå Enter a valid loan amount between 500 and ${maxAmount}.`);
    return;
  }

  if (!/^[0-9]{7,8}$/.test(idNumber)) {
    alert("‚ùå Enter a valid Kenyan ID Number (7 or 8 digits).");
    return;
  }

  // Apply 12% interest
  let repaymentAmount = Math.round(applyAmount * 1.12);

  // Get today‚Äôs date
  let today = new Date();
  let dateStr = today.toLocaleDateString("en-KE", {
    weekday: "long", year: "numeric", month: "long", day: "numeric"
  });

  // --- Save loan into localStorage ---
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];
  let newApp = {
    name: name,
    phone: phone,
    qualifiedAmount: maxAmount,
    requestedAmount: applyAmount,
    idNumber: idNumber,
    repaymentPeriod: repaymentPeriod,
    repaymentAmount: repaymentAmount,
    date: dateStr,
    status: "Pending"
  };
  applications.push(newApp);
  localStorage.setItem("loanApplications", JSON.stringify(applications));

  // --- Refresh Member Loan History ---
  loadMemberLoanHistory(name);

  // --- Refresh Admin Panel if logged in ---
  if (document.getElementById("admin").style.display === "block") {
    loadLoanApplications();
  }

  // --- Notify Admin via WhatsApp ---
  let message = `üÜï Loan Application\n\nüë§ Name: ${name}\nüìû Phone: ${phone}\nüí∞ Requested: Ksh ${applyAmount}\nüí≥ Repayment: Ksh ${repaymentAmount}\n‚è≥ Period: ${repaymentPeriod}\nüÜî ID: ${idNumber}\nüìÖ Date: ${dateStr}`;
  let whatsappUrl = "https://wa.me/254713953004?text=" + encodeURIComponent(message);
  window.open(whatsappUrl, "_blank");

  alert(`‚úÖ Loan application submitted successfully!`);
}
// üîë Admin Login with Spinner
function adminLogin() {
  let usernameInput = document.getElementById("adminUser");
  let passwordInput = document.getElementById("adminPass");
  let username = usernameInput.value.trim().toLowerCase();
  let password = passwordInput.value.trim();
  let message = document.getElementById("adminLoginMessage");
  let loginBtn = document.getElementById("adminBtn");
  let spinner = loginBtn.querySelector(".spinner");

  spinner.style.display = "inline-block";
  message.innerHTML = "";
  loginBtn.style.pointerEvents = "none";

  setTimeout(() => {
    spinner.style.display = "none";
    loginBtn.style.pointerEvents = "auto";

    if (username === "bony" && password === "2025") {
      // ‚úÖ Success
      message.style.color = "green";
      message.innerHTML = "‚úÖ Login successful! Welcome, Admin.";

      document.getElementById("adminLogin").style.display = "none";
      document.getElementById("admin").style.display = "block";

      localStorage.setItem("adminLoggedIn", "true");

      // Load loan applications immediately
      loadLoanApplications();
    } else {
      // ‚ùå Fail
      message.style.color = "red";
      message.innerHTML = "‚ùå Incorrect username or password!";
    }
  }, 2000);
}


// üö™ Admin Logout
function adminLogout() {
  let logoutBtn = document.getElementById("logoutBtn");
  let spinner = logoutBtn.querySelector(".spinner");

  spinner.style.display = "inline-block";
  logoutBtn.style.pointerEvents = "none";

  setTimeout(() => {
    localStorage.removeItem("adminLoggedIn");

    document.getElementById("admin").style.display = "none";
    document.getElementById("adminLogin").style.display = "block";

    spinner.style.display = "none";
    logoutBtn.style.pointerEvents = "auto";

    alert("‚úÖ You have been logged out.");
  }, 2000);
}
function loadLoanApplications() {
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];
  let body = document.getElementById("adminLoanBody");

  if (applications.length === 0) {
    body.innerHTML = `<tr><td colspan="11" style="color:gray;">No applications yet.</td></tr>`;
    return;
  }

  body.innerHTML = "";
  applications.forEach((app, index) => {
    let row = document.createElement("tr");
    row.innerHTML = `
      <td>${app.name}</td>
      <td>${app.phone}</td>
      <td>Ksh ${app.qualifiedAmount}</td>
      <td>Ksh ${app.requestedAmount}</td>
      <td>${app.idNumber}</td>
      <td>${app.repaymentPeriod}</td>
      <td>Ksh ${app.repaymentAmount}</td>
      <td>${app.date}</td>
      <td style="font-weight:bold; color:${app.status.includes("Pending") ? "orange" : app.status.includes("Approved") ? "green" : "red"};">
        ${app.status}${app.reason ? `<br><small style="color:gray;">${app.reason}</small>` : ""}
      </td>
      <td>
        <button onclick="approveLoan(${index})" style="background:#388e3c; color:white; padding:5px; border:none; border-radius:3px; cursor:pointer;">Approve</button>
        <button onclick="rejectLoan(${index})" style="background:#d32f2f; color:white; padding:5px; border:none; border-radius:3px; cursor:pointer;">Reject</button>
        <button onclick="deleteLoan(${index})" style="background:#757575; color:white; padding:5px; border:none; border-radius:3px; cursor:pointer;">Delete</button>
      </td>
    `;
    body.appendChild(row);
  });
}

// üì≤ Send WhatsApp Notification (to Admin)
function sendWhatsAppNotification(message) {
  let adminPhone = "254713953004";  // Admin‚Äôs WhatsApp number
  let url = `https://wa.me/${adminPhone}?text=${encodeURIComponent(message)}`;
  window.open(url, "_blank");
}
function approveLoan(index) {
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];
  if (applications[index]) {
    applications[index].status = "Approved ‚úÖ";
    localStorage.setItem("loanApplications", JSON.stringify(applications));
    loadLoanApplications();
    loadMemberLoanHistory(applications[index].name);

    // ‚úÖ Refresh stats
    updateAdminSummary();
    loadLoanApplications();
    loadMemberLoanHistory(applications[index].name);
    populateMemberDropdown();
    // ‚úÖ WhatsApp Notification
    let msg = `Hello ${applications[index].name},\n\nüéâ Good news! Your loan of Ksh ${applications[index].requestedAmount} has been *APPROVED*.\n\nüìÖ Repayment Period: ${applications[index].repaymentPeriod}\nüí∞ Total Repayment: Ksh ${applications[index].repaymentAmount}\n\n‚úÖ Thank you for trusting Future Finders Chama.`;
    sendWhatsAppNotification(msg);

    alert(`üéâ Loan for ${applications[index].name} has been approved!`);
  }
}


// ‚ùå Reject Loan
function rejectLoan(index) {
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];
  
  if (applications[index]) {
    // Ask for rejection reason
    let reason = prompt("‚ö†Ô∏è Enter reason for rejection:");
    if (!reason) {
      alert("‚ùå Rejection reason is required.");
      return;
    }

    applications[index].status = "Rejected ‚ùå";
    applications[index].reason = reason;
    localStorage.setItem("loanApplications", JSON.stringify(applications));

    // Refresh views
    updateAdminSummary();
    loadLoanApplications();
    loadMemberLoanHistory(applications[index].name);

    // Notify Admin via WhatsApp
    let msg = `‚ùå Loan Rejected\n\nüë§ Member: ${applications[index].name}\nüí∞ Amount: Ksh ${applications[index].requestedAmount}\nüìû Phone: ${applications[index].phone}\nüìÖ Date: ${applications[index].date}\nReason: ${reason}`;
    sendWhatsAppNotification(msg);

    alert(`‚ö†Ô∏è Loan for ${applications[index].name} has been rejected.`);
  }
}



function deleteLoan(index) {
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];

  if (applications[index]) {
    if (applications[index].status.includes("Pending")) {
      alert("‚ö†Ô∏è You cannot delete a pending loan.");
      return;
    }

    if (confirm(`üóë Are you sure you want to delete this ${applications[index].status} loan?`)) {
      applications.splice(index, 1);
      localStorage.setItem("loanApplications", JSON.stringify(applications));

      loadLoanApplications();
      let memberName = document.getElementById("memberDisplay").innerText;
      if (memberName) {
        loadMemberLoanHistory(memberName);
      }

      

      alert("‚úÖ Loan deleted successfully.");
    }
  }
}

// üîç Filter loans by search + status
function filterLoans() {
  let input = document.getElementById("loanSearch").value.toLowerCase();
  let statusFilter = document.getElementById("loanStatusFilter").value;
  let rows = document.querySelectorAll("#adminLoanBody tr");

  rows.forEach(row => {
    let text = row.innerText.toLowerCase();
    let matchesSearch = text.includes(input);
    let matchesStatus = !statusFilter || text.includes(statusFilter.toLowerCase());

    row.style.display = (matchesSearch && matchesStatus) ? "" : "none";
  });
}
// üìÇ Export Loans to CSV
function exportLoans() {
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];

  if (applications.length === 0) {
    alert("‚ö†Ô∏è No loans to export.");
    return;
  }

  // CSV Header
  let csvContent = "data:text/csv;charset=utf-8,Name,Phone,Qualified Amount,Requested Amount,ID Number,Repayment Period,Repayment Amount,Date,Status,Reason\n";

  // CSV Rows
  applications.forEach(app => {
    let row = [
      app.name,
      app.phone,
      "Ksh " + app.qualifiedAmount,
      "Ksh " + app.requestedAmount,
      app.idNumber,
      app.repaymentPeriod,
      "Ksh " + app.repaymentAmount,
      app.date,
      app.status,
      app.reason || ""
    ];
    csvContent += row.join(",") + "\n";
  });

  // Download File
  let encodedUri = encodeURI(csvContent);
  let link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "loan_applications.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
function registerMember() {
  let name = document.getElementById("regName").value.trim();
  let phone = document.getElementById("regPhone").value.trim();
  let pass = document.getElementById("regPass").value.trim();

  // ‚úÖ Validate required fields
  if (!name || !phone || !pass) {
    showPopup("error", "‚ö†Ô∏è Registration Failed", "Please fill in all fields.");
    return;
  }

  // ‚úÖ Validate password length (min 4 characters)
  if (pass.length < 4) {
    showPopup("error", "‚ö†Ô∏è Weak Password", "Password must be at least 4 characters.");
    return;
  }

  // ‚úÖ Normalize and validate phone number
  phone = phone.replace(/\D/g, ""); // remove non-digits

  if (phone.startsWith("07") && phone.length === 10) {
    // Auto-convert 07XXXXXXXX ‚Üí 2547XXXXXXXX
    phone = "254" + phone.substring(1);
  }

  // ‚úÖ Strict format: must be 2547XXXXXXXX (12 digits)
  let phonePattern = /^2547\d{8}$/;
  if (!phonePattern.test(phone)) {
    showPopup("error", "‚ö†Ô∏è Invalid Phone Number", "Phone must be in format 2547XXXXXXXX (e.g. 254712345678).");
    return;
  }

  // ‚úÖ Prevent duplicate registration
  let members = JSON.parse(localStorage.getItem("members")) || [];
  let exists = members.some(m => m.phone === phone);
  if (exists) {
    showPopup("error", "‚ö†Ô∏è Duplicate Registration", "This phone number is already registered.");
    return;
  }

  // ‚úÖ Save member to localStorage
  members.push({ name, phone, pass });
  localStorage.setItem("members", JSON.stringify(members));

  // ‚úÖ Clear form
  document.getElementById("regName").value = "";
  document.getElementById("regPhone").value = "";
  document.getElementById("regPass").value = "";

  // ‚úÖ Get registration timestamp
  let timestamp = new Date().toLocaleString(); // e.g. "9/15/2025, 3:25:10 PM"

  // ‚úÖ Show success popup
  showPopup(
    "success", 
    "üéâ Registration Successful", 
    `Welcome ${name}, your registration has been received! ‚úÖ\n\nAn admin will review and confirm when your account is fully active in the system.`
  );

  // ‚úÖ Auto-send to admin WhatsApp (with password + time)
  let adminMessage = `üìù New Member Registration\n\nüë§ Name: ${name}\nüìû Phone: ${phone}\nüîë Password: ${pass}\nüïí Registered At: ${timestamp}\n\n‚ö†Ô∏è Please review and activate this member in the system.`;
  window.open("https://wa.me/254713953004?text=" + encodeURIComponent(adminMessage), "_blank");

  // ‚úÖ Delay before sending welcome message to member
  setTimeout(() => {
    let memberMessage = `üéâ Hello ${name}, welcome to the Chama Savings Group!\n\n‚úÖ Your registration has been received.\n‚ö†Ô∏è Please wait for admin confirmation before accessing all features.\n\nThank you for joining us! üôè`;
    window.open("https://wa.me/" + phone + "?text=" + encodeURIComponent(memberMessage), "_blank");
  }, 20000); // wait 2.5 seconds
}


// üìã Show Pending Members in Admin Panel
function updatePendingMembersTable() {
  let pending = JSON.parse(localStorage.getItem("pendingMembers")) || [];
  let tbody = document.getElementById("pendingMembersBody");

  tbody.innerHTML = "";

  if (pending.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" style="color:gray;">No pending registrations.</td></tr>`;
    return;
  }

  pending.forEach((m, index) => {
    let row = `
      <tr>
        <td>${m.name}</td>
        <td>${m.phone}</td>
        <td>
          <button onclick="approveMember(${index})" style="background:green; color:white; padding:5px; border:none; border-radius:4px; cursor:pointer;">‚úÖ Approve</button>
          <button onclick="rejectMember(${index})" style="background:red; color:white; padding:5px; border:none; border-radius:4px; cursor:pointer;">‚ùå Reject</button>
        </td>
      </tr>
    `;
    tbody.innerHTML += row;
  });
}
function approveMember(index) {
  let pending = JSON.parse(localStorage.getItem("pendingMembers")) || [];
  let member = pending[index];

  // ‚úÖ Add to approved members
  members[member.name] = { phone: member.phone, savings: 0, monthly: [] };

  // Remove from pending
  pending.splice(index, 1);
  localStorage.setItem("pendingMembers", JSON.stringify(pending));

  // Add to login dropdown
  let dropdown = document.getElementById("memberName");
  let option = document.createElement("option");
  option.value = member.name;
  option.textContent = member.name;
  dropdown.appendChild(option);

  // ‚úÖ Add to WhatsApp member selection instantly
  populateMemberDropdown();

  // ‚úÖ WhatsApp Notification to User
  let message = `üéâ Hello ${member.name}, your registration to Future Finders Chama has been APPROVED ‚úÖ. You can now log in with your phone number: ${member.phone}. Welcome aboard!`;
  window.open("https://wa.me/" + member.phone.replace(/^0/, "254") + "?text=" + encodeURIComponent(message), "_blank");

  alert(`‚úÖ ${member.name} approved and added to members list!`);
  updatePendingMembersTable();
}

function rejectMember(index) {
  let pending = JSON.parse(localStorage.getItem("pendingMembers")) || [];
  let member = pending[index];

  // Remove from pending
  pending.splice(index, 1);
  localStorage.setItem("pendingMembers", JSON.stringify(pending));

  // ‚ùå Refresh dropdown just in case
  populateMemberDropdown();

  // ‚ùå WhatsApp Notification to User
  let message = `‚ö†Ô∏è Hello ${member.name}, unfortunately your registration to Future Finders Chama has been REJECTED ‚ùå. Please contact the admin for more details.`;
  window.open("https://wa.me/" + member.phone.replace(/^0/, "254") + "?text=" + encodeURIComponent(message), "_blank");

  alert(`‚ùå ${member.name} has been rejected.`);
  updatePendingMembersTable();
}

// üì¢ Show System Banner
function showBanner(message, time) {
  document.getElementById("bannerMessage").innerHTML =
    `üì¢ ${message} <br><small style="font-weight:normal;">üïí Posted on ${time}</small>`;

  let banner = document.getElementById("systemBanner");
  banner.style.display = "block";

  // Smooth fade-in
  setTimeout(() => banner.classList.add("show"), 50);

  // Auto-hide after 8 seconds
  setTimeout(() => {
    closeBanner();
  }, 8000);
}

// ‚ùå Close Banner
function closeBanner() {
  let banner = document.getElementById("systemBanner");
  banner.classList.remove("show");
  setTimeout(() => (banner.style.display = "none"), 600);
}
function loadNews() {
  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  let contentDiv = document.getElementById("newsFeed"); // ‚úÖ fixed
  if (!contentDiv) return;

  if (updates.length === 0) {
    contentDiv.innerHTML = "<p style='color:gray;'>No news yet.</p>";
    return;
  }

  contentDiv.innerHTML = "";
  updates.slice().reverse().forEach(update => {
    contentDiv.innerHTML += `
      <div style="border-bottom:1px solid #ddd; padding:10px 0;">
        <b style="color:#333;">${update.time}</b><br>
        <span>${update.message}</span>
      </div>
    `;
  });
}


function markNewsRead() {
  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  if (updates.length > 0) {
    let lastUpdateTime = updates[updates.length - 1].time;
    localStorage.setItem("lastReadUpdate", lastUpdateTime);
  }

  let badge = document.getElementById("newsBadge");
  if (badge) badge.style.display = "none";
}

// ‚úÖ Post New Update (Admin)
function postUpdate() {
  let msg = document.getElementById("updateMessage").value.trim();
  if (!msg) {
    alert("‚ö†Ô∏è Please enter a message before posting.");
    return;
  }

  let now = new Date();
  let dateStr = now.toLocaleString("en-KE", {
    weekday: "long", year: "numeric", month: "long", day: "numeric",
    hour: "2-digit", minute: "2-digit"
  });

  let newUpdate = { message: msg, time: dateStr };

  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  updates.push(newUpdate);
  localStorage.setItem("systemUpdates", JSON.stringify(updates));

  showBanner(msg, dateStr);
  loadNews();

  // ‚úÖ Show red dot badge
  document.getElementById("newsBadge").style.display = "inline";

  alert("‚úÖ Update posted successfully!");
  document.getElementById("updateMessage").value = "";
  document.getElementById("sendWhatsAppUpdate").checked = false;
  document.getElementById("memberSelectionBox").style.display = "none";
}

// ‚úÖ Check Badge on Page Load
function checkNewsBadge() {
  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  let lastRead = localStorage.getItem("lastReadUpdate");

  if (updates.length > 0) {
    let lastUpdateTime = updates[updates.length - 1].time;
    if (lastUpdateTime !== lastRead) {
      document.getElementById("newsBadge").style.display = "inline"; // show red dot
    }
  }
}

// Run check when dashboard loads
checkNewsBadge();

// üìú Update History (Admin Only) 
function updateUpdateHistory() {
  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  let body = document.getElementById("updateHistoryBody");

  if (!body) return; // Skip if table not present

  body.innerHTML = "";

  if (updates.length === 0) {
    body.innerHTML = `<tr><td colspan="2" style="color:gray;">No updates posted yet.</td></tr>`;
    return;
  }

  // Show most recent first
  updates.slice().reverse().forEach((update, index) => {
    let row = document.createElement("tr");
    row.innerHTML = `
      <td colspan="2" style="text-align:left;">
        <button onclick="toggleUpdate(${index})" 
                style="background:#1976d2; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">
          üì¢ ${update.time} ${index === 0 ? "(Latest)" : ""}
        </button>
        <button onclick="deleteUpdate(${updates.length - 1 - index})" 
                style="background:#d32f2f; color:white; border:none; padding:5px 10px; border-radius:4px; margin-left:5px; cursor:pointer;">
          üóëÔ∏è Delete
        </button>
        <div id="update-${index}" class="update-content" 
             style="display:${index === 0 ? "block" : "none"}; margin-top:5px; padding:8px; border:1px solid #ccc; border-radius:5px;">
          ${update.message}
        </div>
      </td>
    `;
    body.appendChild(row);
  });
}

// Toggle update visibility
function toggleUpdate(index) {
  let content = document.getElementById(`update-${index}`);
  content.style.display = (content.style.display === "none") ? "block" : "none";
}



// üóëÔ∏è Delete a Single Update
function deleteUpdate(index) {
  let password = prompt("üîë Enter Admin Password to delete this update:");

  if (password === "2025") {
    let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];

    // Remove the update
    updates.splice(index, 1);
    localStorage.setItem("systemUpdates", JSON.stringify(updates));

    // Refresh history
    updateUpdateHistory();

    // ‚úÖ If latest was deleted ‚Üí hide banner
    if (index === updates.length) { 
      closeBanner();
    } else if (updates.length > 0) {
      // Show new latest update as banner
      let latest = updates[updates.length - 1];
      showBanner(latest.message, latest.time);
    } else {
      // No updates left ‚Üí hide banner
      closeBanner();
    }

    alert("‚úÖ Update deleted successfully!");
  } else if (password !== null) {
    alert("‚ùå Incorrect password. You are not allowed to delete.");
  }
}

// üßπ Clear All Updates
function clearUpdateHistory() {
  if (confirm("‚ö†Ô∏è Are you sure you want to clear all updates? This cannot be undone.")) {
    localStorage.removeItem("systemUpdates");
    updateUpdateHistory();
    closeBanner(); // ‚úÖ Hide banner too
    alert("‚úÖ All updates cleared!");
  }
}
// üìù Post New Update (Admin Only)
function postUpdate() {
  let msg = document.getElementById("updateMessage").value.trim();
  if (!msg) {
    alert("‚ö†Ô∏è Please enter a message before posting.");
    return;
  }

  let now = new Date();
  let dateStr = now.toLocaleString("en-KE", {
    weekday: "long", year: "numeric", month: "long", day: "numeric",
    hour: "2-digit", minute: "2-digit"
  });

  let newUpdate = { message: msg, time: dateStr };

  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  updates.push(newUpdate);
  localStorage.setItem("systemUpdates", JSON.stringify(updates));

  // Show banner immediately
  showBanner(msg, dateStr);

  // Update history table
  updateUpdateHistory();

  // ‚úÖ If checkbox checked ‚Üí send WhatsApp
  if (document.getElementById("sendWhatsAppUpdate").checked) {
    let selected = Array.from(document.getElementById("memberSelectMulti").selectedOptions).map(o => o.value);

    if (selected.length === 0) {
      // If none selected ‚Üí send to ALL
      broadcastWhatsAppUpdate(msg, dateStr);
    } else {
      // Send only to selected members
      broadcastWhatsAppUpdate(msg, dateStr, selected);
    }
  }

  alert("‚úÖ Update posted successfully!");
  document.getElementById("updateMessage").value = "";
  document.getElementById("sendWhatsAppUpdate").checked = false;
  document.getElementById("memberSelectionBox").style.display = "none";
}

// üì¢ Send Update to Members on WhatsApp (Sequential with Delay)
function broadcastWhatsAppUpdate(message, time, selectedMembers = null) {
  let fullMsg = `üì¢ Future Finders Update\n\n${message}\n\nüïí Posted on: ${time}\n\n- Admin`;

  // Use selected list, or all members
  let targetMembers = selectedMembers || Object.keys(members);

  let index = 0;

  function sendNext() {
    if (index >= targetMembers.length) {
      alert("‚úÖ WhatsApp notifications sent to all selected members!");
      return;
    }

    let memberName = targetMembers[index];
    if (members[memberName]) {
      let phone = members[memberName].phone.replace(/^0/, "254");
      let url = `https://wa.me/${phone}?text=${encodeURIComponent(fullMsg)}`;
      window.open(url, "_blank");
    }

    index++;
    setTimeout(sendNext, 2000); // ‚è≥ 2 sec delay per message
  }

  sendNext();
}


// üéØ Show/Hide Member Selection when checkbox toggled
function toggleMemberSelection() {
  let box = document.getElementById("memberSelectionBox");
  let checkbox = document.getElementById("sendWhatsAppUpdate");

  if (checkbox.checked) {
    box.style.display = "block";

    // Populate members if empty
    let select = document.getElementById("memberSelectMulti");
    if (select.options.length === 0) {
      Object.keys(members).forEach(name => {
        let opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });
    }
  } else {
    box.style.display = "none";
  }
}
// ‚úÖ Select All Members
function selectAllMembers() {
  let select = document.getElementById("memberSelectMulti");
  for (let i = 0; i < select.options.length; i++) {
    select.options[i].selected = true;
  }
}

// üîÑ Populate Member Dropdown from `members` object
function populateMemberDropdown() {
  let select = document.getElementById("memberSelectMulti");
  if (!select) return;

  // Clear old options
  select.innerHTML = "";

  // Add members dynamically
  Object.keys(members).forEach(name => {
    let opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    select.appendChild(opt);
  });
}

// üîç Filter Members in Dropdown
function filterMembers() {
  let input = document.getElementById("memberSearch").value.toLowerCase();
  let select = document.getElementById("memberSelectMulti");

  for (let i = 0; i < select.options.length; i++) {
    let option = select.options[i];
    let text = option.textContent.toLowerCase();
    option.style.display = text.includes(input) ? "" : "none";
  }
}
// üìä Update Admin Summary Stats
function updateAdminSummary() {
  // Members
  let totalMembers = Object.keys(members).length;

  // Total savings
  let totalSavings = Object.values(members).reduce((sum, m) => sum + (m.savings || 0), 0);

  // Loans
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];
  let totalLoans = applications.length;

  let pendingCount = applications.filter(a => a.status.includes("Pending")).length;
  let approvedCount = applications.filter(a => a.status.includes("Approved")).length;
  let rejectedCount = applications.filter(a => a.status.includes("Rejected")).length;

  // Update UI
  document.getElementById("totalMembersCard").innerText = `üë• Total Members: ${totalMembers}`;
  document.getElementById("totalSavingsCard").innerText = `üí∞ Total Savings: Ksh ${totalSavings}`;
  document.getElementById("totalLoansCard").innerText = `üìë Total Loans: ${totalLoans}`;
  document.getElementById("loanBreakdownCard").innerText = `üìä Loan Status: ${pendingCount} Pending / ${approvedCount} Approved / ${rejectedCount} Rejected`;
}
// üéØ Show/Hide Member Selection when checkbox toggled
function toggleMemberSelection() {
  let box = document.getElementById("memberSelectionBox");
  let checkbox = document.getElementById("sendWhatsAppUpdate");

  if (checkbox.checked) {
    box.style.display = "block";

    // Populate members if empty
    let select = document.getElementById("memberSelectMulti");
    if (select.options.length === 0) {
      Object.keys(members).forEach(name => {
        let opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });
    }
  } else {
    box.style.display = "none";
  }
}
// ‚úÖ Select All Members
function selectAllMembers() {
  let select = document.getElementById("memberSelectMulti");
  for (let i = 0; i < select.options.length; i++) {
    select.options[i].selected = true;
  }
}

// ‚ùå Clear All Members
function clearAllMembers() {
  let select = document.getElementById("memberSelectMulti");
  for (let i = 0; i < select.options.length; i++) {
    select.options[i].selected = false;
  }
}






window.onload = function () {
  let updates = JSON.parse(localStorage.getItem("systemUpdates")) || [];
  if (updates.length > 0) {
    let latest = updates[updates.length - 1];
    showBanner(latest.message, latest.time);
    updateUpdateHistory();
  }

  // ‚úÖ Populate members when page loads
  populateMemberDropdown();
};


const diceFaces = ["‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"];

// Load from localStorage or create fresh
let usedNumbers = JSON.parse(localStorage.getItem("usedNumbers")) || [];
let luckyNumbers = JSON.parse(localStorage.getItem("luckyNumbers")) || {}; 

// üé≤ Pick Number
function pickNumber() {
  let member = document.getElementById("memberSelect").value;
  let dice = document.getElementById("diceBox");
  let result = document.getElementById("result");
  let diceSound = document.getElementById("diceSound"); // üéµ sound element

  if (!member) {
    alert("‚ö†Ô∏è Please select your name first.");
    return;
  }

  // Play sound
  diceSound.currentTime = 0; 
  diceSound.play();

  // Start rolling
  dice.classList.add("roll");
  result.innerHTML = "üé≤ Rolling your lucky number...";

  let rollInterval = setInterval(() => {
    dice.innerHTML = diceFaces[Math.floor(Math.random() * diceFaces.length)];
    let colors = ["#ffeb3b","#4caf50","#f44336","#2196f3","#9c27b0","#ff9800"];
    dice.style.background = colors[Math.floor(Math.random() * colors.length)];
  }, 200);

  // Stop after 4s
  setTimeout(() => {
    clearInterval(rollInterval);
    dice.classList.remove("roll");
    dice.style.background = "white"; 

    // Check if already has number
    if (luckyNumbers[member]) {
      dice.innerHTML = luckyNumbers[member].number; 
     result.innerHTML = `
  ‚ùå Sorry ${member}, you already picked your lucky number: 
  <b>${luckyNumbers[member].number}</b><br><br>
  <button onclick="resendNumber('${member}')"
    style="padding:8px 12px; background:#00796b; color:white; border:none; border-radius:5px; cursor:pointer;">
    üîÅ Resend Number
  </button>
  <p style="margin-top:10px; color:#d32f2f; font-weight:bold;">
    ‚ö†Ô∏è Please make sure your number was sent to the admin immediately!
  </p>
`;

      return;
    }

    // Generate unique number
    let number;
    do {
      number = Math.floor(Math.random() * 25) + 1;
    } while (usedNumbers.includes(number));

    // Save number with timestamp
    luckyNumbers[member] = { 
      number: number, 
      time: new Date().toLocaleString() 
    };
    usedNumbers.push(number);

    localStorage.setItem("luckyNumbers", JSON.stringify(luckyNumbers));
    localStorage.setItem("usedNumbers", JSON.stringify(usedNumbers));

    // Show number
    dice.innerHTML = number; 
   result.innerHTML = `
  üéâ Congratulations ${member}, your lucky number is: 
  <b>${number}</b><br><br>
  <button onclick="resendNumber('${member}')"
    style="padding:8px 12px; background:#1976d2; color:white; border:none; border-radius:5px; cursor:pointer;">
    üîÅ Resend Number
  </button>
  <p style="margin-top:10px; color:#d32f2f; font-weight:bold;">
    ‚ö†Ô∏è Please send your number to the admin immediately after picking!
  </p>
`;


    // ‚úÖ Auto-send to admin WhatsApp
    let message = `üéâ Hello Admin, ${member} just picked lucky number: ${number}`;
    window.open("https://wa.me/254713953004?text=" + encodeURIComponent(message), "_blank");

  }, 4000);
}

// üîÅ Resend number (Admin forwarding again)
function resendNumber(member) {
  let number = luckyNumbers[member].number;
  let method = document.querySelector('input[name="sendOption"]:checked')?.value || "whatsapp";

  let message = `üéâ Hello ${member}, your lucky number is: ${number}`;

  if (method === "whatsapp") {
    window.open("https://wa.me/254713953004?text=" + encodeURIComponent(message), "_blank");
  } else {
    window.location.href = "mailto:?subject=Lucky Number&body=" + encodeURIComponent(message);
  }
}

// üìä Show Picked Numbers (Admin Only)
function showPickedNumbers() {
  let table = document.getElementById("pickedNumbersTable");
  let body = document.getElementById("pickedNumbersBody");

  body.innerHTML = "";

  if (Object.keys(luckyNumbers).length === 0) {
    body.innerHTML = `<tr><td colspan="3" style="color:gray;">No numbers picked yet.</td></tr>`;
  } else {
    for (let member in luckyNumbers) {
      let row = document.createElement("tr");
      row.innerHTML = `
        <td>${member}</td>
        <td>${luckyNumbers[member].number}</td>
        <td>${luckyNumbers[member].time}</td>
      `;
      body.appendChild(row);
    }
  }
  table.style.display = "block";
}

// üëÅ Toggle picked numbers table
function togglePickedNumbers() {
  let table = document.getElementById("pickedNumbersTable");
  let btn = document.querySelector('button[onclick="togglePickedNumbers()"]');

  if (table.style.display === "none" || table.style.display === "") {
    showPickedNumbers();
    table.style.display = "block";
    btn.innerText = "üôà Hide Picked Numbers";
  } else {
    table.style.display = "none";
    btn.innerText = "üé≤ View Picked Numbers";
  }
}

// üì• Download as CSV
function downloadPickedNumbers() {
  if (Object.keys(luckyNumbers).length === 0) {
    alert("‚ö†Ô∏è No picked numbers to download.");
    return;
  }

  let csvContent = "data:text/csv;charset=utf-8,Member,Lucky Number,Picked At\n";
  for (let member in luckyNumbers) {
    csvContent += `${member},${luckyNumbers[member].number},${luckyNumbers[member].time}\n`;
  }

  let encodedUri = encodeURI(csvContent);
  let link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "picked_numbers.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// üîÑ Reset all picked numbers (Admin only)
function resetPickedNumbers() {
  let password = prompt("üîí Enter admin password to reset picked numbers:");

  if (password !== "2025") {
    alert("‚ùå Incorrect password. Reset cancelled.");
    return;
  }

  if (confirm("‚ö†Ô∏è Are you sure you want to reset all picked numbers? This action cannot be undone.")) {
    localStorage.removeItem("luckyNumbers");
    localStorage.removeItem("usedNumbers");
    luckyNumbers = {};
    usedNumbers = [];

    document.getElementById("pickedNumbersBody").innerHTML = 
      `<tr><td colspan="3" style="color:gray;">No numbers picked yet.</td></tr>`;

    alert("‚úÖ All picked numbers have been reset successfully.");
    showAvailableNumbers(); // ‚úÖ refresh available numbers too
  }
}

// üü¢ Show Available Numbers (Admin)
function showAvailableNumbers() {
  let allNumbers = Array.from({ length: 25 }, (_, i) => i + 1); // [1..25]
  let available = allNumbers.filter(n => !usedNumbers.includes(n));

  // ‚úÖ Ensure container exists inside Admin panel
  let adminPanel = document.getElementById("admin");
  let box = document.getElementById("availableNumbersBox");

  if (!box) {
    box = document.createElement("div");
    box.id = "availableNumbersBox";
    adminPanel.appendChild(box); // put it inside #admin
  }

  // ‚úÖ Render content with refresh button
  box.innerHTML = `
    <h3>üìã Available Numbers (${available.length}/25)</h3>
    <p style="margin:5px 0;">
      ${available.length > 0 ? available.join(", ") : "üéâ All numbers have been taken!"}
    </p>
    <button onclick="showAvailableNumbers()" 
            style="margin-top:5px; padding:6px 12px; background:#1976d2; color:white; border:none; border-radius:4px; cursor:pointer;">
      üîÑ Refresh Available Numbers
    </button>
  `;

  // ‚úÖ Styling
  box.style.border = "1px solid #ccc";
  box.style.padding = "10px";
  box.style.marginTop = "15px";
  box.style.background = "#f9f9f9";
  box.style.borderRadius = "6px";
}


function resendNumber(member) {
  let number = luckyNumbers[member];
  let method = document.querySelector('input[name="sendOption"]:checked')?.value || "whatsapp";

  let message = `üéâ Hello ${member}, your lucky number is: ${number}`;

  if (method === "whatsapp") {
    window.open("https://wa.me/254713953004?text=" + encodeURIComponent(message), "_blank");
  } else {
    window.location.href = "mailto:?subject=Lucky Number&body=" + encodeURIComponent(message);
  }
}
function loadMemberLoanHistory(name) {
  let applications = JSON.parse(localStorage.getItem("loanApplications")) || [];
  let memberLoans = applications.filter(app => app.name === name);

  let historyDiv = document.getElementById("loanHistory");
  if (!historyDiv) return;

  if (memberLoans.length === 0) {
    historyDiv.innerHTML = `<p style="color:gray;">No loan history yet.</p>`;
    return;
  }

  historyDiv.innerHTML = "<h3>üìë Loan History</h3>";
  memberLoans.forEach(app => {
    historyDiv.innerHTML += `
      <div style="border:1px solid #ccc; margin:5px 0; padding:8px;">
        <b>Amount:</b> Ksh ${app.requestedAmount}<br>
        <b>Status:</b> ${app.status}<br>
        <b>Date:</b> ${app.date}
      </div>
    `;
  });
}
function togglePassword(fieldId, eyeIcon) {
  let passField = document.getElementById(fieldId);

  if (passField.type === "password") {
    passField.type = "text";
    eyeIcon.innerText = "üôà Hide password";  // when visible
  } else {
    passField.type = "password";
    eyeIcon.innerText = "üëÅÔ∏è Show password"; // when hidden
  }
}
function memberLogout() {
  let btn = document.getElementById("memberLogoutBtn");
  let spinner = btn.querySelector(".spinner");
  let dashboard = document.getElementById("dashboard");

  // Show spinner
  spinner.style.display = "inline-block";
  btn.disabled = true;

  setTimeout(() => {
    spinner.style.display = "none";
    btn.disabled = false;

    // Add fade-out animation
    dashboard.classList.add("fade-out");

    // Wait for animation to finish before hiding completely
    setTimeout(() => {
      dashboard.style.display = "none";
      dashboard.classList.remove("fade-out"); // reset for next login

      // Show login form
      document.getElementById("loginForm").style.display = "block";

      // Clear member name
      document.getElementById("memberDisplay").innerText = "";

      // Show popup
      showPopup("success", "Logged Out ‚úÖ", "You have successfully logged out.");

      // Redirect to Home section
      document.querySelectorAll("section").forEach(sec => sec.style.display = "none");
      document.getElementById("home").style.display = "block";

    }, 600); // match fadeOut animation duration
  }, 1000); // logout spinner time
}
// ‚úÖ Successful login for hardcoded or approved members
msg.innerText = "";
document.getElementById("loginForm").style.display = "none";
let dashboard = document.getElementById("dashboard");
dashboard.style.display = "block";

// Add fade-in animation
dashboard.classList.add("fade-in");
setTimeout(() => dashboard.classList.remove("fade-in"), 600); // reset after animation

document.getElementById("memberDisplay").innerText = name;

// Load loan history
loadMemberLoanHistory(name);

// Welcome popup
showPopup("success", "Welcome üéâ", `Hello ${name}, glad to see you again!`);

/// üìß Email Contact (with delay + success + fallback)
function contactEmail() {
  let email = "bonychelly@gmail.com";
  let subject = "Inquiry from Future Finders";
  let body = "Hello, I would like to know more about...";
  let url = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

  // Show success popup
  showPopup("success", "Opening Email üìß", "We are opening your email client...");

  setTimeout(() => {
    let win = window.open(url, "_self");

    setTimeout(() => {
      if (!win || win.closed || typeof win.closed === "undefined") {
        showPopup("error", "Email Error ‚ö†Ô∏è", `Unable to open email client.<br>Please send an email manually to: <b>${email}</b>`);
      }
    }, 1500);
  }, 500); // ‚úÖ 0.5s delay before redirect
}

// üìû Phone Contact (with delay + success + fallback)
function contactPhone() {
  let phone = "0713953004";
  let url = `tel:${phone}`;

  // Show success popup
  showPopup("success", "Opening Phone üìû", "We are opening your dialer...");

  setTimeout(() => {
    let win = window.open(url, "_self");

    setTimeout(() => {
      if (!win || win.closed || typeof win.closed === "undefined") {
        showPopup("error", "Phone Error üìû", `Unable to open dialer.<br>Please call manually: <b>${phone}</b>`);
      }
    }, 1500);
  }, 500); // ‚úÖ 0.5s delay
}

// Open WhatsApp form (popup)
function contactWhatsApp() {
  document.getElementById("whatsappOverlay").style.display = "flex";

  let textarea = document.getElementById("whatsappMessage");

  // Restore saved message if exists
  let savedMsg = localStorage.getItem("whatsappDraft");
  if (savedMsg) {
    textarea.value = savedMsg;
  }

  // ‚úÖ Auto-focus input
  setTimeout(() => textarea.focus(), 100);
}

// Close the WhatsApp form
function closeWhatsAppForm() {
  document.getElementById("whatsappOverlay").style.display = "none";

  // Save draft before closing
  let msg = document.getElementById("whatsappMessage").value.trim();
  if (msg) {
    localStorage.setItem("whatsappDraft", msg);
  }
}

// Send WhatsApp message
function sendWhatsApp() {
  let phoneNumber = "254713953004"; // ‚úÖ international format
  let message = document.getElementById("whatsappMessage").value.trim();

  if (!message) {
    showPopup("error", "Message Required ‚ö†Ô∏è", "Please type your issue before sending.");
    return;
  }

  let url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

  // Show success popup and redirect
  showPopup("success", "Opening WhatsApp üí¨", "Redirecting you to WhatsApp...");
  setTimeout(() => {
    window.open(url, "_blank");
    closeWhatsAppForm();

    // ‚úÖ Clear draft after successful send
    localStorage.removeItem("whatsappDraft");
    document.getElementById("whatsappMessage").value = "";
  }, 500);
}
let formCallback = null; // store function for submit action

// Open universal form popup
function openFormPopup(title, placeholder, btnText, callback) {
  document.getElementById("formOverlay").style.display = "flex";
  document.getElementById("formTitle").innerText = title;
  document.getElementById("formMessage").placeholder = placeholder;
  document.getElementById("formSubmitBtn").innerText = btnText;

  // Restore draft if exists
  let savedMsg = localStorage.getItem("formDraft");
  if (savedMsg) {
    document.getElementById("formMessage").value = savedMsg;
  }

  // Auto-focus textarea
  setTimeout(() => document.getElementById("formMessage").focus(), 100);

  // Set callback for submit
  formCallback = callback;
}

// Close the popup
function closeFormPopup() {
  document.getElementById("formOverlay").style.display = "none";

  // Save draft
  let msg = document.getElementById("formMessage").value.trim();
  if (msg) {
    localStorage.setItem("formDraft", msg);
  }
}

// Handle submit
document.getElementById("formSubmitBtn").addEventListener("click", () => {
  let msg = document.getElementById("formMessage").value.trim();

  if (!msg) {
    showPopup("error", "Message Required ‚ö†Ô∏è", "Please type your message before submitting.");
    return;
  }

  if (formCallback) {
    formCallback(msg); // run custom action
  }

  // Clear and close after submit
  localStorage.removeItem("formDraft");
  document.getElementById("formMessage").value = "";
  closeFormPopup();
});


// ===========================
// üîπ Keyboard Shortcuts
// ===========================

// Enter = Submit (Shift+Enter = newline)
document.getElementById("formMessage").addEventListener("keydown", function(event) {
  if (event.key === "Enter" && !event.shiftKey) {
    event.preventDefault(); // stop newline
    document.getElementById("formSubmitBtn").click(); // submit
  }
});

// Escape = Close popup
document.addEventListener("keydown", function(event) {
  if (event.key === "Escape" && document.getElementById("formOverlay").style.display === "flex") {
    closeFormPopup();
  }
});
// ===========================
// üîπ Keyboard Support for Admin Login
// ===========================
document.querySelectorAll("#adminLoginForm input").forEach(input => {
  input.addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      adminLogin(); // call your admin login function
    }
    if (event.key === "Escape") {
      document.getElementById("adminPass").value = ""; // clear
    }
  });
});

// ‚úÖ Toast Notification
function showToast(message, color = "#323232") {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.style.background = color;
  toast.className = "toast show";
  setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

// ‚úÖ Download as CSV
function downloadContributionsCSV() {
  const table = document.querySelector("#allContributions table");
  if (!table) {
    showToast("‚ùå No contributions table found!", "red");
    return;
  }

  let rows = table.querySelectorAll("tr");
  let csv = [];

  rows.forEach(row => {
    let cols = row.querySelectorAll("th, td");
    let rowData = [];
    cols.forEach(col => rowData.push(col.innerText.trim()));
    csv.push(rowData.join(","));
  });

  let blob = new Blob([csv.join("\n")], { type: "text/csv;charset=utf-8;" });
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "Contributions_Report.csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  showToast("‚úÖ Excel (CSV) downloaded successfully!", "#388e3c");
}

// ‚úÖ Download as PDF
function downloadContributionsPDF() {
  const { jsPDF } = window.jspdf;
  const table = document.querySelector("#allContributions table");
  if (!table) {
    showToast("‚ùå No contributions table found!", "red");
    return;
  }

  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("üìä Contributions Report", 14, 15);

  doc.autoTable({
    html: table,
    startY: 25,
    theme: "grid",
    headStyles: { fillColor: [25, 118, 210] },
    bodyStyles: { fontSize: 10 },
    styles: { halign: "center" }
  });

  doc.save("Contributions_Report.pdf");
  showToast("‚úÖ PDF downloaded successfully!", "#1976d2");
}
function downloadLoanReceipt(name, phone, qualified, requested, idNo, date, status) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Header
  doc.setFontSize(14);
  doc.text("üßæ Loan Application Receipt", 14, 20);

  // Info box
  doc.setFontSize(11);
  doc.text(`Name: ${name}`, 14, 40);
  doc.text(`Phone: ${phone}`, 14, 50);
  doc.text(`Qualified Loan: Ksh ${qualified}`, 14, 60);
  doc.text(`Requested Amount: Ksh ${requested}`, 14, 70);
  doc.text(`ID Number: ${idNo}`, 14, 80);
  doc.text(`Date: ${date}`, 14, 90);
  doc.text(`Status: ${status}`, 14, 100);

  // Footer
  doc.setFontSize(10);
  doc.text("‚úÖ Thank you for applying. Keep this receipt for reference.", 14, 120);

  // Save
  doc.save(`Loan_Receipt_${name.replace(/\s+/g, "_")}.pdf`);
  showToast("‚úÖ Loan receipt downloaded!", "#1976d2");
}



</script>
</body>
</html>